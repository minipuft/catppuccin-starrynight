# Catppuccin StarryNight Build & Deployment

## Scope
Authoritative reference for building, validating, and deploying the theme. Aligns with current npm scripts, install helpers, and CI/CD definitions.

## Build Pipelines
- TypeScript (ESBuild): `npm run build:js:dev`, `npm run build:js:prod`, outputs `theme.js` + sourcemap.
- SCSS (SASS/PostCSS): `npm run build:css:dev`, `npm run build:css:prod`, outputs `user.css` + sourcemap.
- Combined build: `npm run build` (dev) and `npm run build:prod`.
- Fast path: `npm run build:fast` (minified outputs without extra checks).
- Watchers: `npm run sass:watch` (SCSS only).

Artifacts live at repo root (`theme.js`, `user.css`, `*.map`). Treat them as build products; do not edit manually.

## Validation & QA
- Type safety: `npm run typecheck` (tsc noEmit).
- Unit/integration tests: `npm test`, or scoped commands (`npm run test:unit`, `npm run test:integration`, etc.).
- Linting: `npm run lint:js`, `npm run lint:css`, `npm run validate` (aggregates typecheck + tests + lint).
- Performance baselines: `npm run test:comprehensive` includes performance suites.

Document pass/fail results in summaries rather than pasting logs.

## Deployment Scripts
- `install.sh` (Linux/macOS)
  * Requires Spicetify CLI on PATH; validates version (2.27+ uses `spicetify backup apply`, legacy uses `spicetify apply`).
  * Copies `theme.js`, `user.css`, `color.ini`, `manifest.json`, `assets`, and `docs` into `$HOME/.config/spicetify/Themes/catppuccin-starrynight` (prompts before overwrite unless `FORCE=true`).
  * Backs up existing config (`spicetify backup`) then sets `current_theme` and `color_scheme` before applying.
- `install-hybrid.sh` (WSL-aware)
  * Validates that `theme.js` is newer than TypeScript sources; warns if rebuild is required.
  * Detects Spicetify in both Linux config path and mapped Windows `%APPDATA%`/`%LOCALAPPDATA%`.
  * Iterates target locations, copying the same artifacts and respecting existing backups; uses `spicetify.exe` when available.
- `install.ps1` (Windows PowerShell)
  * Targets both Roaming and Local AppData `spicetify` folders, copying the same file set plus `Extensions/` directory.
  * Prompts before overwrite unless `-Force`; verifies essential files (theme, css, manifest, color.ini) and reports missing extension scripts.
- All scripts assume artifacts already exist; run `npm run build` beforehand for deterministic output.
- Spicetify CLI must be configured; scripts create backups before applying changes.

## CI/CD References
- CI configs located under `.github/workflows/` (GitHub Actions). See `docs/CI_CD/CI_CD_PIPELINE.md` and `README_CI_CD.md` for full pipeline description.
- Pipeline stages: install dependencies, lint/typecheck/test, build artifacts, optional package/upload tasks.
- CI should invoke the same npm commands listed above; update this doc if workflow commands change.

## Troubleshooting
- Builds error with missing Spicetify path: run `spicetify -c` to validate config location or export `SPICETIFY_CONFIG`; hybrid installs log detections per target path.
- `theme.js` outdated warning (hybrid script): rebuild with `npm run build` before re-running installer.
- Windows installs missing extension file: ensure `Extensions/catppuccin-starrynight.js` exists and rerun install with `-Force`.
- CI lint/test mismatches: clear `node_modules` then `npm install`/`npm ci`; cache issues surface in `actions/cache` logs.
- Runtime issues: review `logs/` and `runtime-state/` directories generated by install scripts and the theme for diagnostics.

## Pending Work
- Add exact CI command snippets and workflow links once verified in `.github/workflows`.
- Provide deployment matrix (OS-specific instructions) after cross-checking scripts.
- Document release packaging steps if `build/` artifacts are required.

## CI/CD Workflows
- `.github/workflows/ci.yml`
  * Triggers on pushes/PRs to `main`/`develop` and nightly cron.
  * Jobs: **quality-gates** (npm ci, `npm run typecheck`, lint commands), **build-and-test** matrix (Node 18/20/22 running `npm run build:ci`, `npm test -- --coverage`), **performance-analysis** (bundle size check using `npm run build:fast` and compare), and optional artifact upload to Codecov/actions.
- `comprehensive-testing.yml`
  * Runs extended test suites (`npm run test:comprehensive`, integration/performance subsets) on demand or schedule.
- `performance-monitoring.yml`
  * Executes targeted performance benchmarks (`npm run test:performance`) and reports bundle metrics.
- `quality-gates.yml`
  * Stand-alone lint/typecheck workflow for lightweight validation (mirrors steps from ci quality-gates).
- `deployment.yml` / `release.yml`
  * Package build artifacts, publish release bundles, and (optionally) push to distribution channels.

Keep this section aligned with workflow files whenever commands change.


## Verification Notes
- 2025-10-06: Reviewed `install.sh`, `install-hybrid.sh`, `install.ps1`, and `.github/workflows/ci.yml`/`comprehensive-testing.yml`/`performance-monitoring.yml` when updating build/deploy guide.
