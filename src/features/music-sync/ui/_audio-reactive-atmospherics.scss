// ████████████████████████████████████████████████████████████████████████████████
// AUDIO-REACTIVE ATMOSPHERICS - Music-Synchronized UI Effects System
// ████████████████████████████████████████████████████████████████████████████████
//
// This module provides comprehensive audio-reactive UI effects, combining:
// - Filter-based effects (brightness, saturation, hue-rotate, cinematic grading)
// - Animation-based effects (floating, breathing, atmospheric transforms)
// - Emotional temperature integration with real-time audio analysis
// - Performance-first design with comprehensive accessibility support
//
// Core Philosophy: Audio-visual synchronization with OKLAB color science
// Visual Language: Cyberpunk neon aesthetics + atmospheric floating animations
// Color System: Dynamic temperature mapping (1000K-20000K spectrum)
//
// CONSOLIDATION: Phase 8.2 - Audio-Reactive Atmospherics Unification
// - Merged: visual-effects-main.scss (474 lines) + ambient_effects.scss (931 lines)
// - Result: ~1,050 lines (25% reduction from 1,405 lines)
// - Aligned CSS variables with TypeScript VisualEffectsCoordinator (--sn-visual-effects-*)
// - Preserved: debug mode, emotional temp, search exclusion, accessibility
//
// IMPORTANT: This file is SEPARATE from src/features/visual-effects/ directory
// - visual-effects/: Glassmorphism, gradients, visual layers
// - music-sync/ui/: Audio-reactive filters and atmospheric animations (this file)
//
// ████████████████████████████████████████████████████████████████████████████████

@use "../../../core/performance_mixins" as *;
@use "../../../core/mixins" as *;
@use "../../../core/design_tokens" as *;

// ════════════════════════════════════════════════════════════════════════════════
// SECTION 1: FOUNDATION & VARIABLES
// ════════════════════════════════════════════════════════════════════════════════

:root {
  // === AUDIO-REACTIVE SYSTEM (TypeScript-aligned) ===
  --sn-visual-effects-enabled: 1;
  --sn-visual-effects-system-loaded: 1;
  --sn-visual-effects-active: 1;
  --sn-visual-effects-intensity: 0.7; // 0-1 effects intensity
  --sn-visual-effects-mode: 'balanced'; // 'balanced', 'cinematic', 'atmospheric', 'dynamic-tech'
  --sn-visual-effects-quality: 1.0; // 0-1 visual effects quality

  // === PERFORMANCE SETTINGS (TypeScript-aligned) ===
  --sn-visual-performance-mode: 'optimal'; // 'minimal', 'balanced', 'optimal', 'maximum'
  --sn-visual-performance-animation-quality: 1.0; // 0-1 animation quality level

  // === ATMOSPHERIC LAYOUT PARAMETERS ===
  --sn-visual-effects-grid-gap: 1.5rem;
  --sn-visual-effects-hover-lift: 4px;
  --sn-visual-effects-transition-duration: 0.6s;
  --sn-visual-effects-float-range: 8px;
  --sn-visual-effects-animation-duration: 12s;
  --sn-visual-effects-stagger-delay: 0.1s;
  --sn-visual-effects-grid-scale: 1.02;

  // === EMOTIONAL TEMPERATURE INTEGRATION ===
  --sn-visual-effects-emotional-intensity: var(--audio-emotional-intensity, 0.5);
  --sn-visual-effects-temperature-kelvin: var(--audio-temperature-kelvin, 4000);
  --sn-visual-effects-breathing-cycle: var(--audio-breathing-cycle, 8s);
  --sn-visual-effects-warmth: var(--audio-warmth-factor, 0.8);
  --sn-visual-effects-emotional-saturation: var(--audio-emotional-saturation, 1.0);
  --sn-visual-effects-temperature-brightness: var(--audio-temperature-brightness, 1.0);

  // === ARTIST AURA FIELD INTEGRATION ===
  --sn-visual-effects-aura-influence: calc(
    var(--artist-aura-intensity, 0.6) * var(--aura-cascade-strength, 0.3)
  );
  --sn-visual-effects-aura-breathing: var(--artist-aura-breathing-sync, 8s);

  // === DEBUG & DEVELOPMENT FLAGS ===
  --sn-visual-effects-debug-mode: 0; // Set to 1 to enable debug visualization
  --sn-visual-effects-development-mode: 0; // Set to 1 for development helpers

  // === SYSTEM READY FLAGS ===
  --sn-audio-reactive-atmospherics-loaded: 1;
  --sn-visual-effects-system-ready: 1;
}

// ════════════════════════════════════════════════════════════════════════════════
// SECTION 2: CORE MIXINS
// ════════════════════════════════════════════════════════════════════════════════

// === FILTER-BASED EFFECTS MIXINS ===

// Core visual effects base mixin
@mixin visual-effects-base {
  position: relative;
  @include performance-hardware-acceleration;
}

// Visual effects interaction states
@mixin visual-effects-interaction-states {
  transition: all var(--sn-visual-effects-transition-duration, 0.5s) ease-out;

  &:hover {
    filter: brightness(1.1);
  }

  &:active {
    filter: brightness(0.9);
  }
}

// Visual effects text enhancement
@mixin visual-effects-text-enhancement($intensity: 'medium') {
  @if $intensity == 'high' {
    filter: saturate(1.3) brightness(1.1);
  } @else if $intensity == 'medium' {
    filter: saturate(1.2) brightness(1.05);
  } @else if $intensity == 'low' {
    filter: saturate(1.1) brightness(1.02);
  }
}

// Cinematic color grading mixin
@mixin cinematic-color-grading($mode: 'ambient', $intensity: 0.8) {
  @if $mode == 'ambient' {
    filter:
      saturate(calc(1.0 + #{$intensity} * 0.3))
      brightness(calc(1.0 + #{$intensity} * 0.15))
      contrast(calc(1.0 + #{$intensity} * 0.1));
  }
}

// === ANIMATION-BASED EFFECTS MIXINS ===

// Atmospheric grid layout
@mixin atmospheric-grid {
  position: relative;
  transition: all var(--sn-gradient-transition, 0.8s ease-in-out);
  @include performance-optimized;
}

// Atmospheric item with floating animations and emotional temperature
@mixin atmospheric-item($index: 0) {
  position: relative;
  opacity: 0;
  transform: translateY(var(--sn-visual-effects-float-range, 20px));

  // Enhanced animation with emotional temperature integration
  animation:
    floating-emotional-temperature calc(var(--sn-visual-effects-breathing-cycle, 8s) * (1 + var(--sn-visual-effects-emotional-intensity) * 0.3))
      var(--dynamic-ease-motion, cubic-bezier(0.4, 0, 0.2, 1)) infinite,
    atmospheric-fade-in 0.8s var(--sn-easing-emergence, var(--sn-anim-easing-organic)) forwards;
  animation-delay: calc(var(--sn-visual-effects-stagger-delay, 0.1s) * #{$index});

  @include performance-optimized;

  // Enhanced hover effect with emotional temperature response
  &:hover {
    filter:
      brightness(calc(var(--sn-visual-effects-temperature-brightness, 1.05) * 1.05))
      saturate(calc(var(--sn-visual-effects-emotional-saturation, 1.15) * 1.1))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 0.8));

    transform: translateY(calc(-1 * var(--sn-visual-effects-hover-lift) * (1 + var(--sn-visual-effects-emotional-intensity) * 0.5)));

    box-shadow:
      0 calc(var(--sn-visual-effects-hover-lift) * 2) calc(var(--sn-visual-effects-hover-lift) * 4)
      rgba(var(--audio-emotion-ambient-primary), calc(var(--sn-visual-effects-emotional-intensity) * 0.2)),
      0 0 calc(var(--sn-visual-effects-hover-lift) * 6)
      rgba(var(--audio-emotion-ambient-accent), calc(var(--sn-visual-effects-emotional-intensity) * 0.1));

    transition:
      filter calc(var(--dynamic-transition-medium, 0.3s)) ease,
      transform calc(var(--dynamic-transition-medium, 0.3s)) ease,
      box-shadow calc(var(--dynamic-transition-medium, 0.3s)) ease;
  }
}

// Staggered grid reveal animation
@mixin staggered-reveal($total-items: 6) {
  @for $i from 1 through $total-items {
    &:nth-child(#{$i}) {
      animation-delay: calc(#{$i - 1} * var(--sn-visual-effects-stagger-delay));

      &.loading {
        opacity: 0;
        transform: translateY(20px);
        animation: stagger-fade-in 0.8s ease-out forwards;
        animation-delay: calc(#{$i - 1} * var(--sn-visual-effects-stagger-delay));
      }
    }
  }
}

// ════════════════════════════════════════════════════════════════════════════════
// SECTION 3: KEYFRAMES - FILTER & ANIMATION EFFECTS
// ════════════════════════════════════════════════════════════════════════════════

// === GLOBAL AUDIO-REACTIVE KEYFRAMES ===

@keyframes visual-effects-global-field {
  0% {
    opacity: calc(var(--sn-visual-effects-fog-opacity, 0.02) * var(--sn-visual-effects-intensity, 0.7) * 2);
    background-size: 100% 100%;
  }
  50% {
    opacity: calc(var(--sn-visual-effects-fog-opacity, 0.02) * var(--sn-visual-effects-intensity, 0.7) * 3);
    background-size: 105% 105%;
  }
  100% {
    opacity: calc(var(--sn-visual-effects-fog-opacity, 0.02) * var(--sn-visual-effects-intensity, 0.7) * 2);
    background-size: 100% 100%;
  }
}

@keyframes visual-effects-main-view {
  0% {
    opacity: calc(var(--sn-visual-effects-shimmer-opacity, 0.05) * 2);
    background-position: 0% 0%;
  }
  33% {
    opacity: calc(var(--sn-visual-effects-shimmer-opacity, 0.05) * 3);
    background-position: 50% 50%;
  }
  66% {
    opacity: calc(var(--sn-visual-effects-shimmer-opacity, 0.05) * 2.5);
    background-position: 100% 100%;
  }
  100% {
    opacity: calc(var(--sn-visual-effects-shimmer-opacity, 0.05) * 2);
    background-position: 0% 0%;
  }
}

// === ATMOSPHERIC ANIMATION KEYFRAMES ===

@keyframes floating {
  0%, 100% {
    transform: translateY(0px);
    filter:
      brightness(var(--sn-visual-effects-temperature-brightness, 1))
      saturate(var(--sn-visual-effects-emotional-saturation, 1))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 0.3));
  }
  50% {
    transform: translateY(calc(-1 * var(--sn-visual-effects-float-range)));
    filter:
      brightness(calc(var(--sn-visual-effects-temperature-brightness, 1) * 1.05))
      saturate(calc(var(--sn-visual-effects-emotional-saturation, 1) * 1.1))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 0.5));
  }
}

@keyframes floating-emotional-temperature {
  0%, 100% {
    transform: translateY(0px) scale(1);
    filter:
      brightness(var(--sn-visual-effects-temperature-brightness, 1))
      saturate(var(--sn-visual-effects-emotional-saturation, 1))
      hue-rotate(var(--audio-temperature-hue-shift, 0deg));
    box-shadow:
      0 2px 8px rgba(var(--audio-emotion-ambient-primary), calc(var(--sn-visual-effects-emotional-intensity) * 0.1)),
      0 0 20px rgba(var(--audio-emotion-ambient-accent), calc(var(--sn-visual-effects-emotional-intensity) * 0.05));
  }
  25% {
    transform: translateY(calc(-0.3 * var(--sn-visual-effects-float-range))) scale(1.01);
    filter:
      brightness(calc(var(--sn-visual-effects-temperature-brightness, 1) * 1.02))
      saturate(calc(var(--sn-visual-effects-emotional-saturation, 1) * 1.05))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 1.2));
  }
  50% {
    transform: translateY(calc(-1 * var(--sn-visual-effects-float-range))) scale(1.02);
    filter:
      brightness(calc(var(--sn-visual-effects-temperature-brightness, 1) * 1.05))
      saturate(calc(var(--sn-visual-effects-emotional-saturation, 1) * 1.1))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 1.5));
    box-shadow:
      0 4px 16px rgba(var(--audio-emotion-ambient-primary), calc(var(--sn-visual-effects-emotional-intensity) * 0.15)),
      0 0 30px rgba(var(--audio-emotion-ambient-accent), calc(var(--sn-visual-effects-emotional-intensity) * 0.08));
  }
  75% {
    transform: translateY(calc(-0.6 * var(--sn-visual-effects-float-range))) scale(1.01);
    filter:
      brightness(calc(var(--sn-visual-effects-temperature-brightness, 1) * 1.03))
      saturate(calc(var(--sn-visual-effects-emotional-saturation, 1) * 1.07))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 1.2));
  }
}

@keyframes floating-subtle {
  0%, 100% {
    transform: translateY(0px);
    filter:
      brightness(var(--sn-visual-effects-temperature-brightness, 1))
      saturate(var(--sn-visual-effects-emotional-saturation, 1))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 0.2));
  }
  50% {
    transform: translateY(calc(-0.7 * var(--sn-visual-effects-float-range)));
    filter:
      brightness(calc(var(--sn-visual-effects-temperature-brightness, 1) * 1.03))
      saturate(calc(var(--sn-visual-effects-emotional-saturation, 1) * 1.05))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 0.3));
  }
}

// === EMOTIONAL TEMPERATURE SPECIFIC ANIMATIONS ===

@keyframes atmospheric-calm-breathing {
  0%, 100% {
    transform: translateY(0px) scale(1);
    filter:
      brightness(var(--audio-temperature-brightness, 1))
      saturate(var(--audio-emotional-saturation, 1))
      blur(0.5px);
  }
  50% {
    transform: translateY(calc(-0.5 * var(--sn-visual-effects-float-range))) scale(1.005);
    filter:
      brightness(calc(var(--audio-temperature-brightness, 1) * 1.02))
      saturate(calc(var(--audio-emotional-saturation, 1) * 1.05))
      blur(0.3px);
  }
}

@keyframes atmospheric-energetic-pulse {
  0%, 100% {
    transform: translateY(0px) scale(1);
    filter:
      brightness(var(--audio-temperature-brightness, 1))
      saturate(var(--audio-emotional-saturation, 1))
      hue-rotate(var(--audio-temperature-hue-shift, 0deg));
  }
  20% {
    transform: translateY(calc(-0.2 * var(--sn-visual-effects-float-range))) scale(1.01);
    filter:
      brightness(calc(var(--audio-temperature-brightness, 1) * 1.08))
      saturate(calc(var(--audio-emotional-saturation, 1) * 1.15))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 1.3));
  }
  40% {
    transform: translateY(calc(-0.8 * var(--sn-visual-effects-float-range))) scale(1.02);
    filter:
      brightness(calc(var(--audio-temperature-brightness, 1) * 1.12))
      saturate(calc(var(--audio-emotional-saturation, 1) * 1.25))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 1.5));
  }
  60% {
    transform: translateY(calc(-1.2 * var(--sn-visual-effects-float-range))) scale(1.025);
    filter:
      brightness(calc(var(--audio-temperature-brightness, 1) * 1.15))
      saturate(calc(var(--audio-emotional-saturation, 1) * 1.3))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 1.8));
  }
  80% {
    transform: translateY(calc(-0.6 * var(--sn-visual-effects-float-range))) scale(1.01);
    filter:
      brightness(calc(var(--audio-temperature-brightness, 1) * 1.10))
      saturate(calc(var(--audio-emotional-saturation, 1) * 1.2))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) * 1.4));
  }
}

@keyframes atmospheric-melancholy-drift {
  0%, 100% {
    transform: translateY(0px) scale(1);
    filter:
      brightness(calc(var(--audio-temperature-brightness, 1) * 0.95))
      saturate(calc(var(--audio-emotional-saturation, 1) * 0.8))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) + -10deg))
      sepia(0.1);
  }
  50% {
    transform: translateY(calc(-0.8 * var(--sn-visual-effects-float-range))) scale(1.01);
    filter:
      brightness(calc(var(--audio-temperature-brightness, 1) * 1.0))
      saturate(calc(var(--audio-emotional-saturation, 1) * 0.9))
      hue-rotate(calc(var(--audio-temperature-hue-shift, 0deg) + -5deg))
      sepia(0.15);
  }
}

@keyframes atmospheric-fade-in {
  from {
    opacity: 0;
    transform: translateY(var(--sn-visual-effects-float-range, 20px));
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes stagger-fade-in {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// === NAVIGATION ORBITAL DRIFT ===

@keyframes navigation-orbital-drift {
  0% {
    transform: rotateY(0deg) translateX(2px) rotateY(0deg);
  }
  25% {
    transform: rotateY(90deg) translateX(4px) rotateY(-90deg);
  }
  50% {
    transform: rotateY(180deg) translateX(2px) rotateY(-180deg);
  }
  75% {
    transform: rotateY(270deg) translateX(4px) rotateY(-270deg);
  }
  100% {
    transform: rotateY(360deg) translateX(2px) rotateY(-360deg);
  }
}

// ════════════════════════════════════════════════════════════════════════════════
// SECTION 4: BASE CSS CLASSES
// ════════════════════════════════════════════════════════════════════════════════

.visual-effects-container {
  @include visual-effects-base;
  filter: saturate(1.0) brightness(1.0);
  transition: all var(--sn-visual-effects-transition-duration, 0.5s) ease-out;
}

.visual-effects-enabled {
  @extend .visual-effects-container !optional;
}

.visual-effects-audio-resonance {
  filter:
    saturate(calc(1.0 + var(--sn-visual-effects-audio-resonance, 0.7) * 0.2))
    brightness(calc(1.0 + var(--sn-visual-effects-audio-resonance, 0.7) * 0.1));
}

.visual-effects-beat-sync {
  transition: filter 0.1s ease-out;
}

.visual-effects-audio-responsive {
  @extend .visual-effects-audio-resonance !optional;
}

.visual-effects-neon-theme {
  filter: saturate(1.3) brightness(1.1);
}

.visual-effects-volumetric-fog {
  backdrop-filter: blur(2px);
}

.visual-effects-holographic-display {
  mix-blend-mode: overlay;
}

.visual-effects-luminescent-tech {
  filter: saturate(1.2) brightness(1.05);
}

.visual-effects-crystalline-glassmorphism {
  backdrop-filter: blur(1px) saturate(1.2);
}

.dynamic-environmental-effects {
  filter: saturate(1.1) brightness(1.02);
}

// ════════════════════════════════════════════════════════════════════════════════
// SECTION 5: ELEMENT APPLICATIONS - UNIFIED FILTER + ANIMATION EFFECTS
// ════════════════════════════════════════════════════════════════════════════════

:root {
  // === GLOBAL .Root CONTAINER ===
  .Root {
    @extend .visual-effects-container !optional;

    // Global visual effects field
    &::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;

      background: radial-gradient(
        ellipse at center,
        rgba(var(--sn-visual-effects-primary-rgb, 205, 214, 244), calc(var(--sn-visual-effects-fog-opacity, 0.02) * var(--sn-visual-effects-intensity, 0.7) * 2)) 0%,
        rgba(var(--sn-visual-effects-holographic-rgb, 116, 199, 236), calc(var(--sn-visual-effects-fog-opacity, 0.02) * var(--sn-visual-effects-intensity, 0.7) * 1)) 50%,
        transparent 80%
      );

      pointer-events: none;
      z-index: calc(var(--sn-visual-effects-depth-atmosphere, 0) - 10);
      @include performance-hardware-acceleration;
      contain: strict;
      mix-blend-mode: overlay;
    }

    // Audio-reactive mode variations
    &[data-visual-effects-mode="cinematic"] {
      @include cinematic-color-grading('ambient', var(--sn-visual-effects-cinematic-intensity, 0.8));
      @extend .visual-effects-neon-theme !optional;
      @extend .visual-effects-volumetric-fog !optional;
    }

    &[data-visual-effects-mode="atmospheric"] {
      position: relative;
      &::after {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background-image: radial-gradient(circle at 20% 30%, oklab-color('accent', 0.1) 2px, transparent 2px);
        background-size: 40px 40px;
        animation: particle-float 8s ease-in-out infinite;
      }
      background: radial-gradient(ellipse at center,
        oklab-color('accent', 0.2) 0%,
        oklab-color('accent', 0.05) 60%,
        transparent 100%);
      filter: blur(2px);
      @extend .dynamic-environmental-effects !optional;

      filter:
        saturate(calc(1.0 + var(--sn-visual-effects-emotional-saturation, 1) * 0.3))
        brightness(calc(1.0 + var(--sn-visual-effects-warmth, 0.8) * 0.15));
    }

    &[data-visual-effects-mode="dynamic-tech"] {
      @extend .visual-effects-holographic-display !optional;
      @extend .visual-effects-luminescent-tech !optional;
      @extend .visual-effects-crystalline-glassmorphism !optional;
      backdrop-filter: blur(1px) saturate(1.2);
    }
  }

  // === MAIN VIEW CONTAINER ===
  .Root__main-view {
    @extend .visual-effects-container !optional;

    &.visual-effects-enabled {
      position: relative;

      &::before {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;

        background: linear-gradient(
          135deg,
          rgba(var(--sn-visual-effects-primary-rgb, 205, 214, 244), calc(var(--sn-visual-effects-shimmer-opacity, 0.05) * 2)) 0%,
          rgba(var(--sn-visual-effects-holographic-rgb, 116, 199, 236), calc(var(--sn-visual-effects-shimmer-opacity, 0.05) * 1)) 50%,
          rgba(var(--sn-visual-effects-accent-rgb, 203, 166, 247), calc(var(--sn-visual-effects-shimmer-opacity, 0.05) * 1.5)) 100%
        );

        pointer-events: none;
        z-index: calc(var(--sn-visual-effects-depth-atmosphere, 0) - 5);
        mix-blend-mode: overlay;
      }
    }
  }

  // === PLAYER BAR & CONTROLS ===
  .Root__nav-bar,
  .Root__now-playing-bar,
  .player-controls {
    &.visual-effects-enabled {
      position: relative;

      &::before {
        content: '';
        position: absolute;
        top: -2px; left: -2px; right: -2px; bottom: -2px;
        border: 2px solid rgba(var(--sn-visual-effects-neon-glow-rgb, 116, 199, 236), calc(var(--sn-visual-effects-border-opacity, 0.3) * 1.2));
        border-radius: inherit;
        background: rgba(var(--sn-visual-effects-primary-rgb, 205, 214, 244), var(--sn-visual-effects-fog-opacity, 0.02));
        pointer-events: none;
        z-index: var(--sn-visual-effects-depth-mid, 2);
      }

      filter:
        saturate(calc(1.0 + var(--sn-visual-effects-emotional-saturation, 1) * 0.3))
        brightness(calc(1.0 + var(--sn-visual-effects-audio-resonance, 0.7) * 0.2));

      @extend .visual-effects-audio-resonance !optional;
      @extend .visual-effects-beat-sync !optional;
    }
  }

  // === SIDEBAR ===
  .Root__nav-bar {
    &.visual-effects-enabled {
      &[data-fog-type="light"] {
        background: linear-gradient(45deg,
          rgba(var(--sn-base-rgb), 0.9) 0%,
          oklab-color('accent', 0.1) 50%,
          rgba(var(--sn-base-rgb), 0.9) 100%);
        backdrop-filter: blur(10px);
      }

      &::after {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;

        background: linear-gradient(
          180deg,
          rgba(var(--sn-visual-effects-atmosphere-rgb, 88, 91, 112), calc(var(--sn-visual-effects-fog-opacity, 0.02) * 3)) 0%,
          rgba(var(--sn-visual-effects-primary-rgb, 205, 214, 244), calc(var(--sn-visual-effects-fog-opacity, 0.02) * 2)) 50%,
          rgba(var(--sn-visual-effects-atmosphere-rgb, 88, 91, 112), calc(var(--sn-visual-effects-fog-opacity, 0.02) * 3)) 100%
        );

        pointer-events: none;
        z-index: calc(var(--sn-visual-effects-depth-atmosphere, 0) - 3);
        mix-blend-mode: multiply;
      }
    }
  }

  // === CARDS - UNIFIED FILTER + ANIMATION ===
  .card,
  .main-card,
  .artist-card,
  .playlist-card,
  .playlist-playlist,
  .artist-artist,
  .album-album,
  .track-row {
    &.visual-effects-enabled {
      @extend .visual-effects-container !optional;

      &::before {
        content: '';
        position: absolute;
        top: -2px; left: -2px; right: -2px; bottom: -2px;
        border: 2px solid rgba(var(--sn-visual-effects-primary-rgb, 205, 214, 244), var(--sn-visual-effects-border-opacity, 0.3));
        border-radius: inherit;
        background: rgba(var(--sn-visual-effects-primary-rgb, 205, 214, 244), var(--sn-visual-effects-fog-opacity, 0.02));
        pointer-events: none;
        z-index: var(--sn-visual-effects-depth-mid, 2);
        transition: all var(--sn-visual-effects-transition-duration, 0.5s) ease-out;
      }

      &:hover {
        &::before {
          transform: scale(1.05);
          border-color: rgba(var(--sn-visual-effects-accent-rgb, 203, 166, 247), calc(var(--sn-visual-effects-border-opacity, 0.3) * 1.2));
        }

        filter:
          saturate(calc(1.0 + var(--sn-visual-effects-emotional-saturation, 1) * 0.4))
          brightness(calc(1.0 + var(--sn-visual-effects-hover-intensity, 0.3) * 0.2));
      }

      &:active {
        &::before {
          transform: scale(0.95);
          border-color: rgba(var(--sn-visual-effects-neon-glow-rgb, 116, 199, 236), calc(var(--sn-visual-effects-border-opacity, 0.3) * 1.5));
        }
      }
    }
  }

  // === BUTTONS ===
  button,
  .button,
  .Button {
    &.visual-effects-enabled {
      @extend .visual-effects-container !optional;

      &:hover {
        filter: brightness(1.1);
      }

      &:active {
        filter: brightness(0.9);
      }

      filter: saturate(1.2) brightness(1.05);

      &::before {
        content: '';
        position: absolute;
        top: -2px; left: -2px; right: -2px; bottom: -2px;
        border: 2px solid rgba(var(--sn-visual-effects-accent-rgb, 203, 166, 247), calc(var(--sn-visual-effects-border-opacity, 0.3) * 1.5));
        border-radius: inherit;
        background: rgba(var(--sn-visual-effects-primary-rgb, 205, 214, 244), var(--sn-visual-effects-fog-opacity, 0.02));
        pointer-events: none;
        z-index: var(--sn-visual-effects-depth-mid, 2);
        transition: all var(--sn-visual-effects-transition-duration, 0.5s) ease-out;
      }

      @extend .visual-effects-audio-responsive !optional;
    }
  }

  // === TEXT ELEMENTS ===
  h1, h2, h3, h4, h5, h6,
  .main-type-heading {
    &.visual-effects-enabled {
      filter: saturate(1.3) brightness(1.1);
    }
  }

  p, span, div,
  .main-type-body,
  .main-type-bass {
    &.visual-effects-enabled {
      filter: saturate(1.2) brightness(1.05);
    }
  }

  .text-small,
  .description {
    &.visual-effects-enabled {
      filter: saturate(1.1) brightness(1.02);
    }
  }
}

// ════════════════════════════════════════════════════════════════════════════════
// SECTION 6: ATMOSPHERIC LAYOUT APPLICATIONS (NON-SEARCH ONLY)
// ════════════════════════════════════════════════════════════════════════════════

// Apply emotional temperature-aware atmospheric effects OUTSIDE search pages
body:not(:has(.main-searchPage-content)) {
  // === MAIN HOME CONTENT & GRID CONTAINERS ===
  .main-home-content,
  .main-gridContainer-gridContainer {
    @include atmospheric-grid;

    > div,
    > section {
      @include atmospheric-item;
      @include staggered-reveal(8);
    }

    .main-card-card,
    .main-card-cardContainer {
      @include atmospheric-item(var(--sn-visual-effects-stagger-delay));
    }

    // Artist pages get enhanced atmospheric influence
    .main-view-container:has([data-testid*="artist"]) & {
      --sn-visual-effects-grid-gap: calc(1.5rem * (1 + var(--sn-visual-effects-aura-influence) * 0.2));
      --sn-visual-effects-hover-lift: calc(4px * (1 + var(--sn-visual-effects-aura-influence) * 0.5));
      --sn-visual-effects-float-range: calc(8px * (1 + var(--sn-visual-effects-aura-influence) * 0.3));
      --sn-visual-effects-animation-duration: var(--sn-visual-effects-aura-breathing);

      .main-card-card,
      .main-card-cardContainer {
        filter: brightness(calc(1 + 0.02 * var(--sn-visual-effects-aura-influence)))
          saturate(calc(1 + 0.1 * var(--sn-visual-effects-aura-influence)));
      }
    }

    // Navigation mode atmospheric enhancement
    .main-view-container:has(.main-gridContainer-gridContainer) & {
      --sn-visual-effects-grid-gap: var(--navigation-node-distance, 180px);
      --sn-visual-effects-transition-duration: calc(var(--navigation-orbit-speed, 8s) * 0.1);
      perspective: var(--navigation-depth-field, 1200px);
      transform-style: preserve-3d;

      .main-card-card,
      .main-card-cardContainer {
        animation: floating var(--navigation-animation-sync, 8s) ease-in-out infinite,
                   navigation-orbital-drift calc(var(--navigation-orbit-speed) * 2) linear infinite;

        &:hover {
          &::before {
            filter: brightness(1.2) blur(8px);
            transform: scale(1.3);
          }
        }
      }
    }
  }

  // === GRID CONTAINERS WITH STAGGER ANIMATIONS ===
  .main-gridContainer-gridContainer {
    &[data-testid*="grid"] {
      @include atmospheric-grid;

      .main-card-card,
      .main-card-cardContainer {
        @include atmospheric-item;
        @include card-state-base;

        &:nth-child(even) {
          animation-delay: var(--sn-visual-effects-stagger-delay);
        }

        &:nth-child(3n) {
          animation-delay: calc(2 * var(--sn-visual-effects-stagger-delay));
        }
      }
    }
  }

  // === CARDS WITH EMOTIONAL TEMPERATURE ANIMATIONS ===
  .main-card-card,
  .main-card-cardContainer {
    animation: floating-emotional-temperature var(--sn-visual-effects-breathing-cycle, 8s)
      var(--dynamic-ease-motion, cubic-bezier(0.4, 0, 0.2, 1)) infinite;
    transition: transform var(--sn-visual-effects-transition-duration);

    // Apply specific emotional temperature animations
    &:where(.audio-emotion-calm) {
      animation-name: atmospheric-calm-breathing;
      animation-duration: calc(var(--audio-breathing-cycle, 6s) * 1.2);
    }

    &:where(.audio-emotion-energetic, .audio-emotion-aggressive) {
      animation-name: atmospheric-energetic-pulse;
      animation-duration: calc(var(--audio-breathing-cycle, 2s) * 0.8);
    }

    &:where(.audio-emotion-melancholy, .audio-emotion-mysterious) {
      animation-name: atmospheric-melancholy-drift;
      animation-duration: calc(var(--audio-breathing-cycle, 8s) * 1.5);
    }

    &:hover {
      transform: translateY(
        calc(
          -1 * var(--sn-visual-effects-hover-lift) *
          (1 + var(--sn-visual-effects-emotional-intensity, 0.5) * 0.5)
        )
      );

      box-shadow:
        0 calc(var(--sn-visual-effects-hover-lift) * 3) calc(var(--sn-visual-effects-hover-lift) * 6)
        rgba(var(--audio-emotion-ambient-primary), calc(var(--sn-visual-effects-emotional-intensity, 0.5) * 0.15)),
        0 0 calc(var(--sn-visual-effects-hover-lift) * 8)
        rgba(var(--audio-emotion-ambient-accent), calc(var(--sn-visual-effects-emotional-intensity, 0.5) * 0.08));
    }
  }

  .main-gridContainer-gridContainer {
    .main-card-card,
    .main-card-cardContainer {
      opacity: 0;
      transform: translateY(20px);
      animation: stagger-fade-in 0.8s ease-out forwards;
    }
  }

  // === TRACK LISTS ===
  .main-trackList-trackListContentWrapper {
    .main-trackList-trackListRow {
      transition: all var(--sn-visual-effects-transition-duration);
      border-radius: 8px;
      margin: 2px 0;
      background: rgba(var(--spice-rgb-surface0), 0.3);

      @include performance-optimized;
      @include staggered-reveal(18);

      &:hover {
        background: rgba(var(--spice-rgb-surface1), 0.4);
        transform: translateX(4px) scale(1.005);
      }

      &.main-trackList-selected,
      &:has(.main-trackList-playingIcon) {
        background: linear-gradient(
          135deg,
          rgba(var(--spice-rgb-accent), 0.1) 0%,
          rgba(var(--spice-rgb-surface1), 0.2) 100%
        );
        border: 1px solid rgba(var(--spice-rgb-accent), 0.3);
      }
    }
  }

  // === SIDEBAR ===
  .main-yourLibrary-yourLibrary {
    .main-rootlist-wrapper {
      .spicetify-playlist-list {
        li {
          transition: all var(--sn-visual-effects-transition-duration);
          border-radius: 6px;
          margin: 1px 0;
          @include performance-optimized;

          &:hover {
            @include glassmorphism(12px, 0.08, 1.1);
            transform: translateX(2px);
            background: rgba(var(--spice-rgb-surface1), 0.3);
          }

          &[aria-selected="true"],
          &.main-rootlist-rootlistItemActive {
            @extend .sn-ocean-ripple-once !optional;
            background: linear-gradient(
              90deg,
              rgba(var(--spice-rgb-accent), 0.15) 0%,
              rgba(var(--spice-rgb-surface1), 0.1) 100%
            );
            border-left: 3px solid var(--spice-accent);
          }
        }
      }
    }
  }

  // === NAVIGATION BAR ===
  .main-navBar-navBar {
    .main-navBar-navBarLink {
      transition: all var(--sn-visual-effects-transition-duration);
      border-radius: 8px;
      margin: 2px;
      @include performance-optimized;

      &:hover {
        @extend .sn-ocean-ripple-once !optional;
        background: rgba(var(--spice-rgb-surface1), 0.3);
        transform: translateY(-1px);
      }

      &.main-navBar-navBarLinkActive {
        @extend .sn-ocean-ripple-once !optional;
        background: linear-gradient(
          135deg,
          rgba(var(--spice-rgb-accent), 0.2) 0%,
          rgba(var(--spice-rgb-surface1), 0.1) 100%
        );
      }
    }
  }

  // === NOW PLAYING BAR ===
  @include now-playing-bar-root {
    --glass-blur: 6px;
    --glass-saturation: 1.3;
    --glass-opacity: 0.2;
    transition: all var(--sn-visual-effects-transition-duration);
    @include performance-optimized;
    @include glassmorphism-dynamic;

    &:hover {
      --glass-blur: 8px;
      --glass-saturation: 1.5;
      --glass-opacity: 0.25;
    }

    .main-trackInfo-container {
      .main-trackInfo-name,
      .main-trackInfo-artists {
        transition: all var(--sn-visual-effects-transition-duration);

        &:hover {
          transform: translateY(-1px);
          filter: brightness(1.1);
        }
      }
    }

    .main-playPauseButton-button,
    .main-skipButton-button,
    .main-shuffleButton-button {
      transition: all var(--sn-visual-effects-transition-duration);
      border-radius: 50%;
      @include performance-optimized;

      &:hover {
        @extend .sn-ripple-pulse !optional;
        background: rgba(var(--spice-rgb-surface1), 0.3);
        transform: scale(1.05) translateY(-1px);
      }

      &:active {
        transform: scale(0.95);
      }
    }
  }
}

// ════════════════════════════════════════════════════════════════════════════════
// SECTION 7: PERFORMANCE & ACCESSIBILITY
// ════════════════════════════════════════════════════════════════════════════════

// === PERFORMANCE MODE ADAPTATIONS ===

:root[data-organic-performance-mode="minimal"] {
  .visual-effects-container {
    animation: none !important;
    filter: none !important;

    &::before {
      display: none !important;
    }
  }

  .dynamic-atmospheric-particles,
  .dynamic-volumetric-lighting,
  .dynamic-atmospheric-fog {
    &::before,
    &::after {
      display: none !important;
    }
  }
}

:root[data-organic-performance-mode="balanced"] {
  .visual-effects-container {
    animation: none !important;
  }

  .dynamic-atmospheric-particles {
    &::before {
      opacity: calc(var(--sn-visual-effects-cinematic-intensity, 0.8) * 0.3) !important;
    }

    &::after {
      opacity: calc(var(--sn-visual-effects-cinematic-intensity, 0.8) * 0.2) !important;
    }
  }
}

:root[data-visual-effects-performance-mode="maximum"] {
  .visual-effects-container {
    filter:
      saturate(calc(1.0 + var(--sn-visual-effects-emotional-saturation, 1) * 0.5)) !important
      brightness(calc(1.0 + var(--sn-visual-effects-warmth, 0.8) * 0.3)) !important;

    &::before {
      opacity: calc(var(--sn-visual-effects-fog-opacity, 0.02) * 5) !important;
    }
  }

  .dynamic-atmospheric-particles {
    &[data-particle-density="dense"] {
      position: relative;
      &::after {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background-image: radial-gradient(circle at 20% 30%, oklab-color('accent', 0.15) 1px, transparent 1px);
        background-size: 20px 20px;
        animation: particle-float 6s ease-in-out infinite;
      }
    }
  }

  .dynamic-volumetric-lighting {
    &[data-light-intensity="dramatic"] {
      background: radial-gradient(ellipse at center,
        oklab-color('accent', 0.4) 0%,
        oklab-color('accent', 0.1) 60%,
        transparent 100%);
      filter: blur(3px);
      mix-blend-mode: screen;
    }
  }
}

// === ACCESSIBILITY SUPPORT ===

@media (prefers-reduced-motion: reduce) {
  :root {
    --sn-visual-effects-transition-duration: 0.1s;
    --sn-visual-effects-animation-duration: 0s;
    --sn-visual-effects-stagger-delay: 0s;
  }

  .visual-effects-container,
  .Root__main-view,
  .Root__nav-bar,
  .player-controls,
  .card,
  button {
    animation: none !important;
    transition-duration: 0.1s !important;

    &::before,
    &::after {
      animation: none !important;
      transition-duration: 0.1s !important;
    }
  }

  .visual-effects-container {
    filter: none !important;

    &::before {
      opacity: 0.05 !important;
    }
  }

  :root {
    --sn-visual-effects-growth-intensity: 0;
    --sn-visual-effects-border-thickness: 1px;

    .Root::before,
    [class*="visual-effects-"] {
      animation: none !important;
      transition-duration: 0.1s !important;
    }
  }

  * {
    animation: none !important;
    transform: none !important;
  }
}

@media (prefers-contrast: high) {
  .visual-effects-container {
    filter:
      contrast(2.0) !important
      saturate(1.5) !important;
  }

  h1, h2, h3, h4, h5, h6,
  p, span, div {
    &.visual-effects-enabled {
      text-shadow:
        0 0 2px rgba(255, 255, 255, 0.8) !important,
        0 0 4px rgba(var(--sn-visual-effects-primary-rgb, 205, 214, 244), 0.6) !important;
    }
  }

  :root {
    --sn-visual-effects-border-thickness: 3px;
    --sn-visual-effects-emotional-saturation: 1.5;
    --sn-visual-effects-cinematic-contrast: 1.8;

    .visual-effects-enabled {
      filter:
        contrast(var(--sn-visual-effects-cinematic-contrast, 1.8))
        saturate(var(--sn-visual-effects-emotional-saturation, 1.5)) !important;
    }
  }
}

// === MOBILE OPTIMIZATIONS ===

@media (max-width: 768px) {
  :root {
    --sn-visual-effects-grid-gap: 1rem;
    --sn-visual-effects-hover-lift: 2px;
    --sn-visual-effects-transition-duration: 0.3s;
    --sn-visual-effects-float-range: 4px;
    --sn-visual-effects-grid-scale: 1.01;
  }

  .main-card-card,
  .main-card-cardContainer,
  .main-trackList-trackListRow {
    &:hover {
      transform: none;
    }
  }

  .main-card-card,
  .main-card-cardContainer,
  .main-trackList-trackListRow,
  .main-navBar-navBarLink {
    backdrop-filter: none;
    background: rgba(var(--spice-rgb-surface0), 0.8) !important;
  }
}

// === HIGH PERFORMANCE MODE FOR LOW-END DEVICES ===

@media (prefers-reduced-motion: reduce) and (max-width: 768px) {
  .main-card-card,
  .main-card-cardContainer,
  .main-trackList-trackListRow,
  .main-navBar-navBarLink {
    backdrop-filter: none !important;
    animation: none !important;
    transition: none !important;
    transform: none !important;

    &:hover {
      backdrop-filter: none !important;
      transform: none !important;
      filter: brightness(1.05);
    }
  }

  @include now-playing-bar-root {
    backdrop-filter: none !important;
    animation: none !important;
    transition: none !important;
    transform: none !important;

    &:hover {
      backdrop-filter: none !important;
      transform: none !important;
      filter: brightness(1.05);
    }
  }
}

// === PERFORMANCE OPTIMIZATION LAYER ===

@layer audio-reactive.performance {
  .visual-effects-enabled {
    @include performance-hardware-acceleration;
    perspective: 1000px;
  }

  @media (prefers-reduced-motion: reduce), (update: slow) {
    .visual-effects-enabled {
      filter: none !important;
      animation: none !important;
      transition-duration: 0.1s !important;
    }
  }
}

// ════════════════════════════════════════════════════════════════════════════════
// SECTION 8: DEBUG MODE & LEGACY COMPATIBILITY
// ════════════════════════════════════════════════════════════════════════════════

// === DEBUG MODE VISUALIZATION ===

:root.visual-effects-debug {
  &::before {
    content: '✨ AUDIO-REACTIVE ATMOSPHERICS ACTIVE';
    position: fixed;
    top: 10px;
    left: 10px;
    font-size: 12px;
    color: lime;
    background: rgba(0, 0, 0, 0.9);
    padding: 5px 10px;
    border-radius: 4px;
    z-index: 99999;
    pointer-events: none;
    border: 1px solid lime;
  }

  &::after {
    content: '🎵 Effects Intensity: ' attr(data-visual-effects-intensity, '0.7');
    position: fixed;
    top: 50px;
    left: 10px;
    font-size: 11px;
    color: cyan;
    background: rgba(0, 0, 0, 0.9);
    padding: 4px 8px;
    border-radius: 3px;
    z-index: 99998;
    pointer-events: none;
    border: 1px solid cyan;
  }

  .visual-effects-container {
    outline: 3px dashed lime !important;
    outline-offset: 2px;

    &::after {
      content: '🚀 Performance: ' attr(data-visual-effects-performance-mode, 'optimal');
      position: fixed;
      top: 90px;
      left: 10px;
      font-size: 11px;
      color: rgb(var(--sn-musical-harmony-analogous-warm-rgb));
      background: rgba(var(--spice-rgb-base), 0.9);
      padding: 4px 8px;
      border-radius: 3px;
      z-index: 99997;
      pointer-events: none;
      border: 1px solid rgb(var(--sn-musical-harmony-analogous-warm-rgb));
    }
  }

  .visual-effects-enabled {
    position: relative;

    &::after {
      content: '✨ VFX';
      position: absolute;
      top: 4px;
      right: 4px;
      font-size: 10px;
      color: rgb(var(--sn-musical-harmony-complementary-rgb));
      pointer-events: none;
      z-index: 9999;
      background: rgba(var(--spice-rgb-base), 0.9);
      padding: 2px 4px;
      border-radius: 2px;
    }
  }
}

@layer audio-reactive.debug {
  :root.visual-effects-debug {
    @extend :root, .visual-effects-debug;
  }
}

// === LEGACY COMPATIBILITY MAPPINGS ===

:root {
  // Legacy constellation → navigation mappings
  --constellation-node-distance: var(--navigation-node-distance);
  --constellation-orbit-speed: var(--navigation-orbit-speed);
  --constellation-depth-field: var(--navigation-depth-field);
  --constellation-breathing-sync: var(--navigation-animation-sync);

  // Legacy visual effects variable mappings (backward compatibility)
  --visual-effects-enabled: var(--sn-visual-effects-enabled);
  --visual-effects-intensity: var(--sn-visual-effects-intensity);
  --visual-effects-mode: var(--sn-visual-effects-mode);
  --atmospheric-gap: var(--sn-visual-effects-grid-gap);
  --atmospheric-hover-lift: var(--sn-visual-effects-hover-lift);
  --atmospheric-transition: var(--sn-visual-effects-transition-duration);
  --ambient-float-range: var(--sn-visual-effects-float-range);
  --ambient-duration: var(--sn-visual-effects-animation-duration);
}

// Legacy keyframe support
@keyframes constellation-orbital-drift {
  0% { transform: rotateY(0deg) translateX(2px) rotateY(0deg); }
  25% { transform: rotateY(90deg) translateX(4px) rotateY(-90deg); }
  50% { transform: rotateY(180deg) translateX(2px) rotateY(-180deg); }
  75% { transform: rotateY(270deg) translateX(4px) rotateY(-270deg); }
  100% { transform: rotateY(360deg) translateX(2px) rotateY(-360deg); }
}

@keyframes organic-membrane-breathing {
  0% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.95; transform: scale(1.01); }
  100% { opacity: 1; transform: scale(1); }
}

@keyframes dynamic-ambient-field {
  0% { opacity: 1; transform: translateX(0) translateY(0); }
  25% { opacity: 0.98; transform: translateX(1px) translateY(-0.5px); }
  50% { opacity: 0.96; transform: translateX(-0.5px) translateY(1px); }
  75% { opacity: 0.98; transform: translateX(-1px) translateY(-0.5px); }
  100% { opacity: 1; transform: translateX(0) translateY(0); }
}

// ════════════════════════════════════════════════════════════════════════════════
// AUDIO-REACTIVE ATMOSPHERICS SYSTEM READY
// Mark system as fully loaded and ready for TypeScript coordination
// ════════════════════════════════════════════════════════════════════════════════
