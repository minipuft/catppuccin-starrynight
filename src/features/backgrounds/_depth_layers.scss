/**
 * Depth Layer System - Modern layered visual effects
 * Transforms blur into intentional depth layers with content protection
 * 
 * Features: Layered depth effects that enhance user experience while 
 * maintaining clarity and accessibility for content interaction.
 */

// Import the unified breathing animation system from mixins (must be first)
@use "../../core/mixins" as *;

/* ═══════════════════════════════════════════════════════════════════════════════
   🌊 DEPTH LAYER VARIABLES - Foundation Architecture
   ═══════════════════════════════════════════════════════════════════════════════ */

:root {
  /* Depth layer system using design tokens */
  --depth-foreground-clarity: 1.0;
  --depth-background-blur: var(--sn-ui-glass-blur, 20px);
  
  /* Content protection system */
  --content-protection-level: 0.95;
  --chrome-enhancement-level: 2.0;
  --reading-mode-active: 0;
  
  /* Animation timing using design system */
  --depth-animation-duration: var(--sn-anim-transition-cosmic, 1200ms);
  --musical-sync-intensity: var(--sn-music-energy-level, 0.5);
  
  /* Layer management */
  --content-layer-index: var(--sn-layout-z-ui, 10);
  --chrome-layer-index: var(--sn-layout-z-content, 0);
  --background-layer-index: var(--sn-layout-z-background, -11);
  
  /* Unified intensity using design system */
  --depth-effects-intensity: calc(
    var(--sn-bg-gradient-opacity, 0.8) * 
    var(--sn-perf-quality-blur, 1.0) *
    (1 - var(--reading-mode-active) * 0.9)
  );
}

/* ═══════════════════════════════════════════════════════════════════════════════
   🏗️ DEPTH LAYER SYSTEM - Base Architecture
   ═══════════════════════════════════════════════════════════════════════════════ */

.audio-depth-system {
  position: relative;
  
  /* Content Sanctuary - Protected Area for Text & Interactions */
  .content-sanctuary {
    position: relative;
    z-index: var(--content-layer-index);
    backdrop-filter: none; /* No effects on content */
    
    /* Text clarity enhancement */
    text-shadow: none;
    filter: none;
    
    /* Ensure content is always accessible */
    &, * {
      /* Override any inherited blur or distortion */
      backdrop-filter: none !important;
      filter: contrast(1) saturate(1) brightness(1) !important;
    }
    
    /* Emergency clarity mode - complete effect disable */
    &.reading-mode-active {
      --holographic-intensity: 0.01;
      --depth-scanline-opacity: 0.01;
      --depth-scanline-density: 0.01;
      
      /* Force clarity on all descendants */
      * {
        opacity: 1 !important;
        backdrop-filter: none !important;
        filter: none !important;
      }
    }
    
    /* Interactive element clarity boost */
    &:hover, &:focus-within {
      --depth-layer-intensity: calc(var(--depth-effects-intensity) * 0.5);
      
      /* Immediate clarity for interactive elements */
      transition: all 0.2s ease-out;
    }
  }
  
  /* Enhanced Chrome - Enhanced UI Areas */
  .audio-chrome {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: var(--chrome-layer-index);
    pointer-events: none; /* Don't interfere with interactions */
    
    /* Visual enhancement lens using design system */
    backdrop-filter: 
      contrast(calc(1 + var(--depth-effects-intensity) * 0.05))
      saturate(calc(1 + var(--depth-effects-intensity) * 0.08))
      brightness(calc(1 + var(--depth-effects-intensity) * 0.02));
    
    /* Subtle depth breathing using unified system */
    @include breathing-animation('depth', --depth-animation-duration);
    
    /* Enhanced effects in non-content areas only */
    &:not(.content-area-detected) {
      backdrop-filter: 
        contrast(calc(1 + var(--depth-effects-intensity) * 0.15))
        saturate(calc(1 + var(--depth-effects-intensity) * 0.2))
        brightness(calc(1 + var(--depth-effects-intensity) * 0.05));
      
      opacity: calc(var(--depth-effects-intensity) * var(--chrome-enhancement-level) * 0.3);
    }
  }
  
  /* Background Layer - Deep Atmospheric Layer */
  .audio-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: var(--background-layer-index);
    pointer-events: none;
    
    /* Beautiful deep atmospheric effects using design system */
    backdrop-filter: 
      blur(var(--depth-background-blur))
      contrast(calc(1 + var(--depth-effects-intensity) * 0.1))
      saturate(calc(1 + var(--depth-effects-intensity) * 0.2));
    
    /* Cinematic depth enhancement using design system colors */
    background: 
      radial-gradient(
        ellipse 40% 30% at 30% 70%,
        rgba(var(--sn-musical-oklab-primary-rgb), calc(var(--depth-effects-intensity) * 0.08)) 0%,
        transparent 70%
      ),
      radial-gradient(
        ellipse 50% 40% at 70% 30%,
        rgba(var(--sn-musical-oklab-accent-rgb), calc(var(--depth-effects-intensity) * 0.06)) 0%,
        transparent 80%
      );
    
    /* Cinematic blend modes for depth */
    mix-blend-mode: color-dodge;
    opacity: calc(var(--depth-effects-intensity) * 0.4);
  }
}

/* ═══════════════════════════════════════════════════════════════════════════════
   🎵 UNIFIED DEPTH BREATHING ANIMATIONS - Using Central Mixin System
   ═══════════════════════════════════════════════════════════════════════════════ */

/* ═══════════════════════════════════════════════════════════════════════════════
   🎯 CONTENT-AWARE ENHANCEMENT ZONES
   ═══════════════════════════════════════════════════════════════════════════════ */

/* Text-heavy content areas - Maximum protection */
.text-content-area,
.main-trackList-trackListRow,
.main-view-container__scroll-node,
[data-testid*="tracklist"],
[data-testid*="playlist"] {
  @extend .content-sanctuary !optional;
  
  /* Enhanced text protection using design system */
  --holographic-intensity: calc(var(--sn-ui-glass-opacity, 0.5) * 0.1);
  --depth-scanline-opacity: calc(var(--sn-ui-glass-opacity, 0.15) * 0.1);
  --depth-effects-intensity: calc(var(--depth-effects-intensity) * 0.1);
  
  /* Subtle background enhancement only */
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: -1;
    pointer-events: none;
    
    /* Minimal atmospheric enhancement using design system colors */
    background: rgba(var(--sn-musical-oklab-primary-rgb), 0.01);
    @include breathing-animation('gentle', --depth-animation-duration, --sn-anim-easing-organic, 0.3);
  }
}

/* UI Chrome areas - Enhanced depth effects */
.ui-chrome-area,
.Root__nav-bar,
.Root__top-bar,
.Root__now-playing-bar,
.main-topBar-container,
.main-navBar-navBar {
  /* Enhanced visual effects for UI chrome using design system */
  --holographic-intensity: calc(var(--sn-ui-glass-opacity, 0.5) * var(--chrome-enhancement-level));
  --depth-scanline-opacity: calc(var(--sn-ui-glass-opacity, 0.15) * var(--chrome-enhancement-level));
  --depth-effects-intensity: calc(var(--depth-effects-intensity) * var(--chrome-enhancement-level));
  
  /* Full chrome enhancement */
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1;
    pointer-events: none;
    
    /* Enhanced chrome effects */
    @extend .audio-chrome !optional;
    
    /* Stronger atmospheric effects for chrome using design system colors */
    background: 
      linear-gradient(135deg,
        transparent 0%,
        rgba(var(--sn-musical-oklab-primary-rgb), calc(var(--depth-effects-intensity) * 0.1)) 30%,
        transparent 70%
      );
  }
}

/* ═══════════════════════════════════════════════════════════════════════════════
   🌊 ADAPTIVE DEPTH LAYER BEHAVIOR - Using Design System
   ═══════════════════════════════════════════════════════════════════════════════ */

/* High energy music - More chrome effects, same content protection */
.music-energy-high {
  --depth-effects-intensity: calc(var(--depth-effects-intensity) * 1.3);
  --chrome-enhancement-level: 2.5;
  --depth-animation-duration: calc(var(--depth-animation-duration) * 0.7);
  
  /* Content protection increases with energy */
  .content-sanctuary {
    --content-protection-level: 0.98;
    --holographic-intensity: calc(var(--sn-ui-glass-opacity, 0.5) * 0.05);
  }
}

/* Calm music - Gentle effects everywhere */
.music-energy-calm {
  --depth-effects-intensity: calc(var(--depth-effects-intensity) * 0.6);
  --chrome-enhancement-level: 1.2;
  --depth-animation-duration: calc(var(--depth-animation-duration) * 1.8);
  
  .content-sanctuary {
    --content-protection-level: 0.9;
    --holographic-intensity: calc(var(--sn-ui-glass-opacity, 0.5) * 0.15);
  }
}

/* User interaction detected - Reduce all effects */
:root[data-user-interacting="true"] {
  --depth-effects-intensity: calc(var(--depth-effects-intensity) * 0.7);
  --user-interaction-detected: 1;
}

/* Reading mode - Emergency clarity */
:root[data-reading-mode="true"] {
  --reading-mode-active: 1;
  --depth-effects-intensity: calc(var(--depth-effects-intensity) * 0.1);
  
  .audio-chrome {
    opacity: 0.02;
    animation: none;
  }
}

/* ═══════════════════════════════════════════════════════════════════════════════
   ♿ ACCESSIBILITY & PERFORMANCE OPTIMIZATIONS
   ═══════════════════════════════════════════════════════════════════════════════ */

/* Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  .audio-depth-system {
    * {
      animation: none !important;
      transition: none !important;
    }
  }
  
  .audio-chrome {
    opacity: calc(var(--depth-effects-intensity) * 0.3);
  }
}

/* High contrast mode - Enhanced clarity */
@media (prefers-contrast: high) {
  :root {
    --content-protection-level: 0.99;
    --depth-effects-intensity: calc(var(--depth-effects-intensity) * 0.5);
  }
  
  .content-sanctuary {
    background: var(--spice-base);
    border: 1px solid var(--spice-text);
  }
}

/* Low-end device optimization */
@media (max-width: 768px), (max-height: 600px) {
  :root {
    --device-capability-scaling: 0.6;
    --depth-animation-duration: calc(var(--depth-animation-duration) * 2);
  }
  
  .audio-background {
    display: none; /* Remove heavy background effects on mobile */
  }
}

/* ═══════════════════════════════════════════════════════════════════════════════
   🎬 CINEMATIC DEPTH LAYER INTEGRATION - Using Design System
   "Interface layers that enhance visual experience while serving the user."
   ═══════════════════════════════════════════════════════════════════════════════ */

/* Integration with existing visual system */
.main-view-container {
  @extend .audio-depth-system !optional;
  
  /* Override previous effects with depth layer system */
  &::before {
    /* Replace old enhancement lens with content-aware depth layers */
    @extend .audio-chrome !optional;
    
    /* Content-aware positioning - avoid text overlap */
    clip-path: polygon(
      0% 0%, 100% 0%, 100% 20%,    /* Top edge enhancement */
      80% 20%, 80% 80%,            /* Right edge enhancement */
      100% 80%, 100% 100%, 0% 100% /* Bottom edge enhancement */
    );
    
    /* Enhanced depth effects only in non-content areas using design system */
    backdrop-filter: 
      contrast(calc(1 + var(--sn-ui-glass-opacity, 0.5) * 0.03))
      saturate(calc(1 + var(--sn-ui-glass-opacity, 0.5) * 0.05))
      brightness(calc(1 + var(--sn-ui-glass-opacity, 0.5) * 0.01));
  }
}

/* Ensure all content areas are protected */
.main-view-container__scroll-node,
.main-view-container__scroll-node-child {
  @extend .content-sanctuary !optional;
}

/* ============================================================================ */
/* LEGACY COMPATIBILITY - Consolidated */
/* ============================================================================ */