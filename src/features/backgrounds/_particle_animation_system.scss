// =============================================================================
// YEAR 3000 DYNAMIC PARTICLE NETWORK - Advanced Stellar Animation System
// Dynamic animation flows that respond to music and connect to the interface
// =============================================================================

@use "../../core/_mixins" as *;
@use "../../core/_design_tokens" as *;

// Year 3000 Energy Particle System Variables
:root {
  // === Particle Network Core ===
  --particle-network-density: 3;
  --particle-base-speed: 8s;
  --particle-energy-intensity: 0.8;
  --particle-connection-strength: 0.6;
  --particle-interface-influence: 1;

  // === Dynamic Flow Variables ===
  --particle-flow-variance: 15deg;
  --particle-dynamic-curve: var(--sn-easing-smooth, var(--sn-anim-easing-smooth));
  --particle-life-cycle: 12s;
  --particle-emergence-delay: 3s;

  // === Energy Clustering System ===
  --particle-cluster-size: 4;
  --particle-cluster-radius: 80px;
  --particle-cluster-cohesion: 0.7;
  --particle-cluster-drift: 120px;

  // === Dynamic Color Integration ===
  --particle-primary-energy: rgba(
    var(--sn-accent-rgb, var(--sn-accent-rgb, 202,158,230)),
    0.8
  );
  --particle-secondary-energy: rgba(
    var(--sn-accent-rgb, var(--spice-rgb-surface0, 186,187,241)),
    0.6
  );
  --particle-accent-energy: rgba(
    var(--sn-accent-rgb, var(--sn-accent-rgb, 140,170,238)),
    0.7
  );

  // === Contextual Intelligence ===
  --particle-focus-dampening: 0.3; // Reduces in focus contexts
  --particle-discovery-amplification: 1.4; // Enhances in discovery
  --particle-music-modulation: 1; // Responds to music energy

  // === Aurora Background Layer (Extracted from _cosmic_effects.scss) ===
  --aurora-layer-1-intensity: 0.08; // Subtle base layer
  --aurora-layer-2-intensity: 0.05; // More meditative
  --aurora-layer-3-intensity: 0.03; // Very gentle
  --aurora-flow-speed: calc(var(--particle-base-speed) * 3.2); // 25.6s - harmonized rhythm
  --aurora-shimmer-speed: calc(var(--particle-base-speed) * 1.5); // 12s - subtle animation
}

// =============================================================================
// ADVANCED KEYFRAME SYSTEM: Dynamic Animation Flows
// =============================================================================

// Primary Energy Stream - Organic diagonal flow
@keyframes energy-stream-primary {
  0% {
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
  }

  20% {
    transform: translate(-50%, -50%) scale(0.3);
    opacity: 0.8;
  }

  80% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
  }

  85% {
    transform: translate(-50%, -50%) scale(1.1);
    opacity: 0.5;
  }

  95% {
    transform: translate(-50%, -50%) scale(0.9);
    opacity: 0.1;
  }

  100% {
    transform: translate(-50%, -50%) scale(0.3);
    opacity: 0;
  }
}

// Secondary Energy Whisper - Gentle curved flow
@keyframes energy-whisper-secondary {
  0% {
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
  }

  10% {
    transform: translate(-50%, -50%) scale(0.6);
    opacity: calc(var(--particle-energy-intensity) * 0.7);
  }

  30% {
    transform: translate(-50%, -50%) scale(0.8);
    opacity: calc(var(--particle-energy-intensity) * 0.9);
  }

  60% {
    transform: translate(-50%, -50%) scale(0.7);
    opacity: calc(var(--particle-energy-intensity) * 0.8);
  }

  85% {
    transform: translate(-50%, -50%) scale(0.4);
    opacity: 0;
  }

  100% {
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
  }
}

// Animation Pulse - Radiating from interface influence points
@keyframes animation-pulse-interface {
  0% {
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
  }

  20% {
    transform: translate(-50%, -50%) scale(1);
    opacity: calc(
      var(--particle-energy-intensity) * var(--particle-interface-influence)
    );
  }

  40% {
    transform: translate(-50%, -50%) scale(1.2);
    opacity: calc(
      var(--particle-energy-intensity) * var(--particle-interface-influence) * 0.8
    );
  }

  60% {
    transform: translate(-50%, -50%) scale(0.9);
    opacity: calc(
      var(--particle-energy-intensity) * var(--particle-interface-influence) * 0.6
    );
  }

  80% {
    transform: translate(-50%, -50%) scale(0.5);
    opacity: calc(
      var(--particle-energy-intensity) * var(--particle-interface-influence) * 0.3
    );
  }

  100% {
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
  }
}

// Cluster Formation - Particles that form temporary energy clusters
@keyframes energy-cluster-formation {
  0% {
    transform: translate(-50%, -50%) scale(0.5);
    opacity: 0;
  }

  15% {
    transform: translate(-50%, -50%) scale(0.8);
    opacity: calc(
      var(--particle-energy-intensity) * var(--particle-cluster-cohesion)
    );
  }

  30% {
    transform: translate(-50%, -50%) scale(1);
    opacity: calc(
      var(--particle-energy-intensity) * var(--particle-cluster-cohesion) * 1.1
    );
  }

  50% {
    transform: translate(-50%, -50%) scale(1.1);
    opacity: calc(
      var(--particle-energy-intensity) * var(--particle-cluster-cohesion) * 1.2
    );
  }

  70% {
    transform: translate(-50%, -50%) scale(0.9);
    opacity: calc(
      var(--particle-energy-intensity) * var(--particle-cluster-cohesion) * 0.9
    );
  }

  85% {
    transform: translate(-50%, -50%) scale(0.6);
    opacity: calc(
      var(--particle-energy-intensity) * var(--particle-cluster-cohesion) * 0.5
    );
  }

  100% {
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
  }
}

// Animation Twinkle - Dynamic pulsing for ambient particles
@keyframes animation-twinkle-dynamic {
  0%,
  100% {
    opacity: calc(var(--particle-energy-intensity) * 0.6);
    transform: scale(1);
  }

  25% {
    opacity: calc(var(--particle-energy-intensity) * 0.9);
    transform: scale(1.1);
  }

  50% {
    opacity: calc(var(--particle-energy-intensity) * 0.4);
    transform: scale(0.8);
  }

  75% {
    opacity: calc(var(--particle-energy-intensity) * 0.8);
    transform: scale(1.05);
  }
}

// Aurora Background Flow - Gentle shifting aurora effect (from _cosmic_effects.scss)
@keyframes aurora-background-flow {
  0% {
    background-position: 0% 50%, 100% 50%, 50% 0%;
    filter: hue-rotate(0deg) brightness(1);
  }
  25% {
    background-position: 50% 100%, 0% 0%, 100% 50%;
    filter: hue-rotate(8deg) brightness(1.05);
  }
  50% {
    background-position: 100% 50%, 50% 100%, 0% 100%;
    filter: hue-rotate(15deg) brightness(0.98);
  }
  75% {
    background-position: 50% 0%, 100% 50%, 50% 50%;
    filter: hue-rotate(23deg) brightness(1.02);
  }
  100% {
    background-position: 0% 50%, 100% 50%, 50% 0%;
    filter: hue-rotate(30deg) brightness(1);
  }
}

// Nebula Particle Drift - Slow drifting nebula particles (from _cosmic_effects.scss)
@keyframes nebula-particle-drift {
  0% {
    transform: translate3d(0, 0, 0) rotateZ(0deg);
    opacity: 0.3;
  }
  33% {
    transform: translate3d(50px, -40px, 15px) rotateZ(40deg);
    opacity: 0.5;
  }
  66% {
    transform: translate3d(-30px, 50px, -10px) rotateZ(80deg);
    opacity: 0.4;
  }
  100% {
    transform: translate3d(0, 0, 0) rotateZ(120deg);
    opacity: 0.3;
  }
}

// =============================================================================
// YEAR 3000 ENERGY PARTICLE NETWORK CONTAINER
// =============================================================================

@mixin apply-particle-network {
  // Aurora background layer (z-index: -6, deepest layer)
  .Root::before {
    content: "";
    position: fixed;
    top: -10%;
    left: -10%;
    width: 120%;
    height: 120%;
    z-index: -6;
    pointer-events: none;

    // Subtle aurora gradients
    background:
      radial-gradient(
        ellipse 100% 60% at 20% 30%,
        rgba(var(--sn-bg-gradient-primary-rgb), var(--aurora-layer-1-intensity)) 0%,
        transparent 70%
      ),
      radial-gradient(
        ellipse 80% 90% at 80% 60%,
        rgba(var(--sn-bg-gradient-secondary-rgb), var(--aurora-layer-2-intensity)) 0%,
        transparent 60%
      ),
      radial-gradient(
        ellipse 120% 50% at 50% 90%,
        rgba(var(--sn-bg-gradient-accent-rgb), var(--aurora-layer-3-intensity)) 0%,
        transparent 80%
      );

    background-size: 300% 300%, 250% 400%, 400% 200%;
    animation: aurora-background-flow var(--aurora-flow-speed) ease-in-out infinite;
    filter: blur(60px);
  }

  .sn-stars-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: -5;
  overflow: hidden;

  // Enhanced hardware acceleration
  @include performance-optimized;
  transform-style: preserve-3d;
  perspective: 1000px;

  // === Base Energy Particle ===
  .star {
    position: absolute;
    width: calc(var(--particle-cluster-size) * 1px);
    height: calc(var(--particle-cluster-size) * 1px);
    border-radius: 50%;

    // Dynamic energy color that responds to music
    background: radial-gradient(
      circle,
      var(--particle-primary-energy) 0%,
      var(--particle-secondary-energy) 50%,
      transparent 100%
    );

    // Enhanced hardware acceleration
    @include performance-optimized;
    transform-style: preserve-3d;

    // Base animation pulse
    animation: energy-stream-primary
      calc(var(--particle-base-speed) * var(--particle-music-modulation))
      var(--particle-dynamic-curve) infinite;

    // === Enhanced Energy Trail System ===
    &::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: calc(var(--particle-cluster-radius) * 1px);
      height: 2px;
      transform: translate(-50%, -50%) rotate(-45deg);

      // Dynamic trail gradient
      background: linear-gradient(
        90deg,
        var(--particle-primary-energy) 0%,
        var(--particle-accent-energy) 30%,
        transparent 100%
      );

      opacity: calc(var(--particle-energy-intensity) * 0.8);
      filter: blur(0.5px);
      border-radius: 1px;
      @include hardware-accelerated;
    }

    // === Energy Aura Effect ===
    &::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: calc(var(--particle-cluster-size) * 3px);
      height: calc(var(--particle-cluster-size) * 3px);
      transform: translate(-50%, -50%);

      background: radial-gradient(
        circle,
        var(--particle-accent-energy) 0%,
        transparent 70%
      );

      border-radius: 50%;
      opacity: calc(var(--particle-energy-intensity) * 0.4);
      filter: blur(2px);
      @include hardware-accelerated;
    }

    // === Particle Variants: Different Energy Types ===

    // Primary Energy Stream Particles
    &:nth-child(1) {
      --particle-cluster-size: 3;
      top: 15%;
      left: -10%;
      animation: energy-stream-primary calc(var(--particle-base-speed) * 1.2)
        var(--particle-dynamic-curve) infinite;
      animation-delay: 0s;

      background: radial-gradient(
        circle,
        var(--particle-primary-energy) 0%,
        var(--particle-accent-energy) 70%,
        transparent 100%
      );
    }

    &:nth-child(2) {
      --particle-cluster-size: 2;
      top: 25%;
      left: -15%;
      animation: energy-whisper-secondary calc(var(--particle-base-speed) * 0.8)
        var(--particle-dynamic-curve) infinite;
      animation-delay: calc(var(--particle-emergence-delay) * 1);

      background: radial-gradient(
        circle,
        var(--particle-secondary-energy) 0%,
        var(--particle-primary-energy) 60%,
        transparent 100%
      );
    }

    &:nth-child(3) {
      --particle-cluster-size: 4;
      top: 65%;
      left: -5%;
      animation: energy-stream-primary calc(var(--particle-base-speed) * 1.5)
        var(--particle-dynamic-curve) infinite;
      animation-delay: calc(var(--particle-emergence-delay) * 2);

      background: radial-gradient(
        circle,
        var(--particle-accent-energy) 0%,
        var(--particle-secondary-energy) 50%,
        transparent 100%
      );
    }

    // Interface Influence Particles
    &:nth-child(4) {
      --particle-cluster-size: 2.5;
      top: 85%;
      left: -20%;
      animation: animation-pulse-interface calc(var(--particle-base-speed) * 1.1)
        var(--particle-dynamic-curve) infinite;
      animation-delay: calc(var(--particle-emergence-delay) * 0.5);

      background: radial-gradient(
        circle,
        var(--particle-primary-energy) 0%,
        var(--particle-accent-energy) 40%,
        transparent 100%
      );
    }

    &:nth-child(5) {
      --particle-cluster-size: 3.5;
      top: 45%;
      left: -8%;
      animation: energy-cluster-formation calc(var(--particle-base-speed) * 0.9)
        var(--particle-dynamic-curve) infinite;
      animation-delay: calc(var(--particle-emergence-delay) * 1.8);

      background: radial-gradient(
        circle,
        var(--particle-accent-energy) 0%,
        var(--particle-primary-energy) 65%,
        transparent 100%
      );
    }

    // Ambient Energy Particles (twinkle in place)
    &:nth-child(6) {
      --particle-cluster-size: 1.5;
      top: 35%;
      left: 25%;
      animation: animation-twinkle-dynamic calc(var(--particle-life-cycle))
        ease-in-out infinite;
      animation-delay: calc(var(--particle-emergence-delay) * 0.3);

      background: radial-gradient(
        circle,
        var(--particle-secondary-energy) 0%,
        transparent 80%
      );
    }

    &:nth-child(7) {
      --particle-cluster-size: 2;
      top: 75%;
      left: 60%;
      animation: animation-twinkle-dynamic calc(var(--particle-life-cycle) * 1.3)
        ease-in-out infinite;
      animation-delay: calc(var(--particle-emergence-delay) * 2.2);

      background: radial-gradient(
        circle,
        var(--particle-accent-energy) 0%,
        transparent 75%
      );
    }

    &:nth-child(8) {
      --particle-cluster-size: 1.8;
      top: 55%;
      left: 80%;
      animation: animation-twinkle-dynamic calc(var(--particle-life-cycle) * 0.7)
        ease-in-out infinite;
      animation-delay: calc(var(--particle-emergence-delay) * 1.5);

      background: radial-gradient(
        circle,
        var(--particle-primary-energy) 0%,
        transparent 85%
      );
    }

    // === NEBULA PARTICLES (from _cosmic_effects.scss) ===
    // Slow drifting particles that add depth and cosmic atmosphere

    &:nth-child(9) {
      --particle-cluster-size: 2.5;
      top: 20%;
      left: 40%;
      animation: nebula-particle-drift calc(var(--particle-base-speed) * 7.5)
        linear infinite;
      animation-delay: 0s;
      opacity: 0.4;

      background: radial-gradient(
        circle,
        var(--particle-secondary-energy) 0%,
        transparent 70%
      );
    }

    &:nth-child(10) {
      --particle-cluster-size: 3;
      top: 70%;
      left: 15%;
      animation: nebula-particle-drift calc(var(--particle-base-speed) * 9)
        linear infinite reverse;
      animation-delay: calc(var(--particle-emergence-delay) * 2);
      opacity: 0.3;

      background: radial-gradient(
        circle,
        var(--particle-accent-energy) 0%,
        transparent 65%
      );
    }
  }
}

// =============================================================================
// CONTEXTUAL INTELLIGENCE: Adaptive Energy Network
// =============================================================================

// Focus Mode: Reduced particle activity for concentration
.main-searchPage-content,
[data-context="focus"],
.search-focused {
  --particle-energy-intensity: calc(
    var(--particle-energy-intensity) * var(--particle-focus-dampening)
  );
  --particle-network-density: 2;
  --particle-base-speed: calc(var(--particle-base-speed) * 2);

  .sn-stars-container .star:nth-child(n + 4) {
    animation-play-state: paused;
    opacity: 0.2;
  }
}

// Discovery Mode: Enhanced particle activity for exploration
.main-entityHeader-container,
.main-shelf-shelf,
[data-context="discovery"] {
  --particle-energy-intensity: calc(
    var(--particle-energy-intensity) * var(--particle-discovery-amplification)
  );
  --particle-network-density: 5;
  --particle-interface-influence: 1.3;
}

// Music Response Mode: Particles react to playing state
.Root__now-playing-bar:has(.main-trackList-playingIcon),
[data-context="playing"] {
  --particle-music-modulation: 0.7; // Faster, more energetic
  --particle-energy-intensity: calc(var(--particle-energy-intensity) * 1.2);
  --particle-interface-influence: 1.5;

  .sn-stars-container .star {
    animation-duration: calc(var(--particle-base-speed) * 0.6) !important;
  }
}

// Beat-synchronized particle intensification (consolidated from _particle_field.scss & _cosmic_effects.scss)
.Root[style*="--sn-music-beat-pulse-intensity"] {
  // Aurora layer responds to beat
  .Root::before {
    animation-duration: calc(var(--aurora-flow-speed) / max(var(--sn-music-beat-pulse-intensity, 1), 0.7));
    filter: blur(60px)
            brightness(calc(1 + var(--sn-music-beat-pulse-intensity, 0) * 0.15))
            saturate(calc(1 + var(--sn-music-beat-pulse-intensity, 0) * 0.2));
  }

  // Particles pulse with beat
  .sn-stars-container .star {
    animation-duration: calc(var(--particle-base-speed) * 0.8 / max(var(--sn-music-beat-pulse-intensity, 1), 0.5)) !important;
    filter: brightness(calc(1 + var(--sn-music-beat-pulse-intensity, 0) * 0.3))
            saturate(calc(1.2 + var(--sn-music-beat-pulse-intensity, 0) * 0.4));
  }
}

// Genre-responsive particle evolution (from _cosmic_effects.scss)
.Root[style*="--sn-dynamic-genre-hue-shift"] {
  .Root::before {
    filter: blur(60px)
            hue-rotate(var(--sn-dynamic-genre-hue-shift, 0deg))
            brightness(calc(1 + var(--sn-music-energy, 0) * 0.1));
  }

  .sn-stars-container .star {
    filter: hue-rotate(calc(var(--sn-dynamic-genre-hue-shift, 0deg) * 0.3))
            saturate(calc(1.2 + var(--sn-music-valence, 0) * 0.3));
  }
}

// =============================================================================
// UTILITY CLASSES: Network Control
// =============================================================================

.sn-stars-disabled {
  .sn-stars-container {
    display: none;
  }
}

.sn-stars-minimal {
  --particle-network-density: 1;
  --particle-energy-intensity: 0.4;
  --particle-base-speed: calc(var(--particle-base-speed) * 1.5);

  .sn-stars-container .star:nth-child(n + 3) {
    display: none;
  }
}

.sn-stars-intense {
  --particle-network-density: 8;
  --particle-energy-intensity: 1.2;
  --particle-base-speed: calc(var(--particle-base-speed) * 0.7);
  --particle-cluster-size: 5;
  --particle-interface-influence: 1.8;
}

// Interface Mode: Particles cluster around UI elements
.interface-active {
  --particle-interface-influence: 2;
  --particle-cluster-cohesion: 1.2;

  .sn-stars-container .star:nth-child(even) {
    animation-name: animation-pulse-interface;
  }
}

// =============================================================================
// RESPONSIVE & ACCESSIBILITY ADAPTATIONS
// =============================================================================

@media (max-width: 768px) {
  .sn-stars-container {
    --particle-network-density: 2;
    --particle-base-speed: calc(var(--particle-base-speed) * 1.3);
    --particle-cluster-size: 2;

    .star:nth-child(n + 4) {
      display: none;
    }
  }
}

@media (max-width: 480px) {
  .sn-stars-container {
    --particle-network-density: 1;

    .star:nth-child(n + 3) {
      display: none;
    }
  }
}

// Reduced motion: Convert to gentle ambient twinkles
@media (prefers-reduced-motion: reduce) {
  .sn-stars-container {
    .star {
      animation: animation-twinkle-dynamic calc(var(--particle-life-cycle) * 2)
        ease-in-out infinite !important;

      &::before,
      &::after {
        animation: none !important;
        opacity: 0.3 !important;
      }
    }
  }
}

// High contrast: Enhanced visibility
@media (prefers-contrast: high) {
  .sn-stars-container {
    --particle-energy-intensity: 1.5;

    .star {
      background: radial-gradient(
        circle,
        #{oklab-color('highlight', 0.9)} 0%,
        #{oklab-color('highlight', 0.3)} 70%,
        transparent 100%
      ) !important;
    }
  }
}

// Battery optimization: Reduce activity on low battery
@media (prefers-reduced-data: reduce) {
  .sn-stars-container {
    --particle-network-density: 1;
    --particle-base-speed: calc(var(--particle-base-speed) * 3);

    .star:nth-child(n + 3) {
      display: none;
    }
  }
}

// REMOVED (Phase 8.5b): particle-shimmer → unused dead code, no active references
// Shimmer functionality now provided by unified shimmer architecture:
// - Simple effects: @include unified-shimmer($type: 'skeleton|gradient|filter|pulse|text')
// - Advanced effects: @include advanced-shimmer($type: 'holographic|cosmic-depth|fluid-organic|particle-field')

// =============================================================================
// LEGACY COMPATIBILITY MAPPINGS - Phase 6.3 Layer A Modernization
// =============================================================================

:root {
  // === Legacy Nexus → Interface Mappings ===
  --particle-nexus-influence: var(--particle-interface-influence);
  
  // === Legacy Organic → Dynamic Mappings ===
  --particle-organic-curve: var(--particle-dynamic-curve);
}

// Legacy keyframe support
@keyframes energy-pulse-nexus {
  0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
  20% { transform: translate(-50%, -50%) scale(1); opacity: calc(var(--particle-energy-intensity) * var(--particle-nexus-influence)); }
  40% { transform: translate(-50%, -50%) scale(1.2); opacity: calc(var(--particle-energy-intensity) * var(--particle-nexus-influence) * 0.8); }
  60% { transform: translate(-50%, -50%) scale(0.9); opacity: calc(var(--particle-energy-intensity) * var(--particle-nexus-influence) * 0.6); }
  80% { transform: translate(-50%, -50%) scale(0.5); opacity: calc(var(--particle-energy-intensity) * var(--particle-nexus-influence) * 0.3); }
  100% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
}

@keyframes energy-twinkle-organic {
  0%, 100% { opacity: calc(var(--particle-energy-intensity) * 0.6); transform: scale(1); }
  25% { opacity: calc(var(--particle-energy-intensity) * 0.9); transform: scale(1.1); }
  50% { opacity: calc(var(--particle-energy-intensity) * 0.4); transform: scale(0.8); }
  75% { opacity: calc(var(--particle-energy-intensity) * 0.8); transform: scale(1.05); }
}

  // Legacy class mappings
  .nexus-active {
    @extend .interface-active !optional;
  }
}
