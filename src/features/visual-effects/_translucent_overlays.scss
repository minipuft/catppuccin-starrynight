// ████████████████████████████████████████████████████████████████████████████████
// 🛸 LAYERED VISUAL EFFECTS INTEGRATION
// Enhanced layered effects that sync with Color Flow System
// Phase 2.1: Enhanced LayeredUISystem Integration
// Phase 2.2: Cinematic Drama Engine - Red energy bursts with layered interfaces
// ████████████████████████████████████████████████████████████████████████████████

// Note: Visual effect engine styles archived in Phase 10 Week 4 (orphaned files)
// Using existing CSS variables and inline styles for functionality
// - red-energy-burst-effects: Implemented via CSS variables
// - soft-glow-effects: Implemented via backdrop-filter and glow variables
// - soft-nature-effects: Implemented via filter and warmth variables

@use "../../core/_mixins" as *;

// ═══════════════════════════════════════════════════════════════════════════════
// 🌊 COLOR VISUAL EFFECTS INTEGRATION VARIABLES
// ═══════════════════════════════════════════════════════════════════════════════

:root {
  // === LAYERED VISUAL EFFECTS VARIABLES (Set by LayeredVisualEffectsIntegration) ===
  --layered-effect-rgb: 100, 255, 200; // Dynamic dominant color from ColorOrchestrator
  --layered-scanline-rgb: 255, 150, 100; // Dynamic scanline color (complementary)
  --layered-glow-intensity: 0.5; // 0-1 based on visual effects level
  --layered-flicker-rate: 5Hz; // 2-10Hz based on musical energy
  --layered-atmospheric-depth: 0.3; // Volumetric effect intensity
  // Removed: holographic breathing frequency (breathing animations completely removed)
  --layered-chromatic-shift: 2px; // Chromatic aberration intensity
  
  // === ENHANCED ABERRATION SYSTEM VARIABLES (Phase 4.2g Enhancement) ===
  --aberration-intensity: 0.5; // 0-1 overall aberration strength
  --aberration-color-separation: 3px; // RGB channel separation distance
  --aberration-musical-sync: 0.7; // Beat synchronization strength (0-1)
  --aberration-emotional-temperature: 6000K; // Color temperature influence on RGB shifts
  --aberration-visual-effects-level: 0.8; // Visual effects intensity multiplier
  --aberration-reading-mode-reduction: 0.2; // Intensity reduction during reading (0-1)
  --aberration-red-shift: 2px; // Individual red channel displacement
  --aberration-green-shift: 0px; // Individual green channel displacement  
  --aberration-blue-shift: -2px; // Individual blue channel displacement
  --aberration-wave-frequency: 0.5s; // Wave motion frequency
  --aberration-pulse-intensity: 0.3; // Musical pulse modulation strength
  
  // === HYBRID MODE INTEGRATION VARIABLES (WebGL + CSS Coordination) ===
  --aberration-webgl-active: 0; // Set to 1 when WebGL canvas is active
  --aberration-css-enabled: 0; // Set to 1 when CSS effects should be active
  --aberration-hybrid-mode: 0; // Set to 1 when both WebGL and CSS work together
  --aberration-css-opacity: calc(var(--aberration-css-enabled) * (1 - var(--aberration-webgl-active) * 0.7)); // Reduce CSS intensity when WebGL is active
  
  // === VOLUMETRIC DEPTH VARIABLES (Phase 4.2a Enhancement) ===
  --layered-perspective-depth: 1200px; // 3D perspective depth (800px-2000px)
  --volumetric-layer-spacing: 20px; // Z-axis spacing between depth layers
  --volumetric-depth-intensity: 0.8; // 0-1 overall volumetric effect strength
  --visual-effects-depth-offset: 50px; // Consciousness-driven depth adjustment
  --temperature-depth-offset: 25px; // Emotional temperature depth influence
  --volumetric-shadow-blur: 30px; // Depth-based shadow blur radius
  --atmospheric-blur-distance: 4px; // Distance-based atmospheric blur
  
  // === VISUAL EFFECTS DATA STREAM VARIABLES (Phase 4.2b Enhancement) ===
  --visual-effects-data-opacity: 0.8; // Data stream visibility based on visual effects
  --data-stream-intensity: 0.5; // Overall data stream animation intensity
  
  // === VISUAL EFFECTS SCANLINE VARIABLES (Phase 4.2c Enhancement) ===
  --visual-effects-scanline-density: 0.5; // Scanline density based on visual effects level
  --visual-effects-scanline-frequency: 4px; // Dynamic scanline frequency
  --visual-effects-scanline-opacity: 0.15; // Visual effects scanline opacity
  --visual-effects-scanline-speed: 1s; // Scanline animation speed
  --visual-effects-scanline-resonance: 0.5; // Overall visual effects resonance level
  --visual-effects-scanline-temperature: 6000K; // Emotional temperature influence
  --visual-effects-scanline-musical-intensity: 0.5; // Musical intensity influence
  // Removed: visual effects scanline breathing (breathing animations completely removed)
  --temperature-scanline-color-shift: 0deg; // Color hue shift based on temperature
  --musical-scanline-pulse: 0.5; // Musical pulse modulation
  --visual-effects-scanline-interference: none; // Advanced interference patterns
  --visual-effects-scanline-complexity: 0; // Scanline complexity level
  
  // === REAL-TIME MUSICAL RESPONSE ===
  --layered-music-flicker-intensity: 0.3; // Musical flicker response
  // Removed: holographic breathing intensity and phase (breathing animations completely removed)

  // === AESTHETIC MODE INTEGRATION ===
  --layered-cosmic-glow: calc(var(--layered-glow-intensity) * 0.8);
  --layered-red-energy-burst-effects: calc(var(--layered-glow-intensity) * 1.2);
  --layered-ethereal-softness: calc(var(--layered-glow-intensity) * 0.6);
  --layered-natural-warmth: calc(var(--layered-glow-intensity) * 0.7);
}

// ═══════════════════════════════════════════════════════════════════════════════
// ✨ VISUAL EFFECTS LAYERED ANIMATIONS
// ═══════════════════════════════════════════════════════════════════════════════

// Visual effects layered flicker
@keyframes visual-effects-layered-flicker {
  0% {
    opacity: var(--layered-glow-intensity);
    filter: 
      drop-shadow(0 0 5px rgba(var(--layered-effect-rgb), 0.4))
      hue-rotate(0deg);
  }
  25% {
    opacity: calc(var(--layered-glow-intensity) + var(--layered-music-flicker-intensity) * 0.2);
    filter: 
      drop-shadow(0 0 8px rgba(var(--layered-effect-rgb), 0.6))
      hue-rotate(5deg);
  }
  50% {
    opacity: calc(var(--layered-glow-intensity) + var(--layered-music-flicker-intensity) * 0.3);
    filter: 
      drop-shadow(0 0 12px rgba(var(--layered-effect-rgb), 0.8))
      hue-rotate(10deg);
  }
  75% {
    opacity: calc(var(--layered-glow-intensity) + var(--layered-music-flicker-intensity) * 0.2);
    filter: 
      drop-shadow(0 0 8px rgba(var(--layered-effect-rgb), 0.6))
      hue-rotate(5deg);
  }
  100% {
    opacity: var(--layered-glow-intensity);
    filter: 
      drop-shadow(0 0 5px rgba(var(--layered-effect-rgb), 0.4))
      hue-rotate(0deg);
  }
}

// Removed: visual-effects-breathing-scanlines keyframes (breathing animations completely removed)

// Enhanced visual effects chromatic aberration with sophisticated color splitting
@keyframes visual-effects-chromatic-aberration {
  0% {
    filter: 
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * (1 - var(--reading-mode-active, 0) * var(--aberration-reading-mode-reduction))) 
        0 0 
        rgba(255, 0, 0, calc(0.3 * var(--aberration-intensity) * var(--aberration-css-opacity, 1)))
      )
      drop-shadow(
        calc(var(--aberration-blue-shift) * var(--aberration-intensity) * (1 - var(--reading-mode-active, 0) * var(--aberration-reading-mode-reduction))) 
        0 0 
        rgba(0, 100, 255, calc(0.3 * var(--aberration-intensity) * var(--aberration-css-opacity, 1)))
      );
  }
  25% {
    filter: 
      drop-shadow(
        calc(var(--aberration-green-shift) * var(--aberration-intensity) * (1 - var(--reading-mode-active, 0) * var(--aberration-reading-mode-reduction))) 
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * 0.5) 
        0 
        rgba(0, 255, 50, calc(0.25 * var(--aberration-intensity) * var(--aberration-css-opacity, 1)))
      )
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * -0.5) 
        calc(var(--aberration-blue-shift) * var(--aberration-intensity) * (1 - var(--reading-mode-active, 0) * var(--aberration-reading-mode-reduction))) 
        0 
        rgba(255, 50, 150, calc(0.3 * var(--aberration-intensity) * var(--aberration-css-opacity, 1)))
      );
  }
  50% {
    filter: 
      drop-shadow(
        0 
        calc(var(--aberration-color-separation) * var(--aberration-intensity) * (1 - var(--reading-mode-active, 0) * var(--aberration-reading-mode-reduction))) 
        0 
        rgba(100, 255, 100, calc(0.2 * var(--aberration-intensity)))
      )
      drop-shadow(
        0 
        calc(var(--aberration-color-separation) * var(--aberration-intensity) * -1 * (1 - var(--reading-mode-active, 0) * var(--aberration-reading-mode-reduction))) 
        0 
        rgba(255, 100, 255, calc(0.25 * var(--aberration-intensity)))
      );
  }
  75% {
    filter: 
      drop-shadow(
        calc(var(--aberration-blue-shift) * var(--aberration-intensity) * 0.8 * (1 - var(--reading-mode-active, 0) * var(--aberration-reading-mode-reduction))) 
        calc(var(--aberration-green-shift) * var(--aberration-intensity) * 0.3) 
        0 
        rgba(0, 150, 255, calc(0.35 * var(--aberration-intensity)))
      )
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * 0.6 * (1 - var(--reading-mode-active, 0) * var(--aberration-reading-mode-reduction))) 
        0 0 
        rgba(255, 200, 0, calc(0.25 * var(--aberration-intensity)))
      );
  }
  100% {
    filter: 
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * (1 - var(--reading-mode-active, 0) * var(--aberration-reading-mode-reduction))) 
        0 0 
        rgba(255, 0, 0, calc(0.3 * var(--aberration-intensity) * var(--aberration-css-opacity, 1)))
      )
      drop-shadow(
        calc(var(--aberration-blue-shift) * var(--aberration-intensity) * (1 - var(--reading-mode-active, 0) * var(--aberration-reading-mode-reduction))) 
        0 0 
        rgba(0, 100, 255, calc(0.3 * var(--aberration-intensity) * var(--aberration-css-opacity, 1)))
      );
  }
}

// Musical beat-synchronized aberration pulses
@keyframes musical-aberration-pulse {
  0% {
    filter: 
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * var(--musical-scanline-pulse, 0.5)) 
        0 0 
        rgba(255, 0, 0, calc(0.2 * var(--aberration-intensity) * var(--musical-scanline-pulse, 0.5)))
      );
  }
  50% {
    filter: 
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * var(--musical-scanline-pulse, 0.5) * 1.5) 
        0 0 
        rgba(255, 0, 0, calc(0.4 * var(--aberration-intensity) * var(--musical-scanline-pulse, 0.5)))
      )
      drop-shadow(
        calc(var(--aberration-blue-shift) * var(--aberration-intensity) * var(--musical-scanline-pulse, 0.5) * 1.2) 
        0 0 
        rgba(0, 150, 255, calc(0.3 * var(--aberration-intensity) * var(--musical-scanline-pulse, 0.5)))
      );
  }
  100% {
    filter: 
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * var(--musical-scanline-pulse, 0.5)) 
        0 0 
        rgba(255, 0, 0, calc(0.2 * var(--aberration-intensity) * var(--musical-scanline-pulse, 0.5)))
      );
  }
}

// Aberration waves that flow with visual effects
@keyframes visual-effects-aberration-waves {
  0% {
    filter: 
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * sin(0)) 
        calc(var(--aberration-green-shift) * var(--aberration-intensity) * cos(0)) 
        0 
        rgba(255, 100, 100, calc(0.25 * var(--aberration-intensity)))
      );
  }
  25% {
    filter: 
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * 0.707) 
        calc(var(--aberration-green-shift) * var(--aberration-intensity) * 0.707) 
        0 
        rgba(100, 255, 100, calc(0.25 * var(--aberration-intensity)))
      );
  }
  50% {
    filter: 
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * 1) 
        calc(var(--aberration-green-shift) * var(--aberration-intensity) * 0) 
        0 
        rgba(100, 100, 255, calc(0.25 * var(--aberration-intensity)))
      );
  }
  75% {
    filter: 
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * 0.707) 
        calc(var(--aberration-green-shift) * var(--aberration-intensity) * -0.707) 
        0 
        rgba(255, 255, 100, calc(0.25 * var(--aberration-intensity)))
      );
  }
  100% {
    filter: 
      drop-shadow(
        calc(var(--aberration-red-shift) * var(--aberration-intensity) * 0) 
        calc(var(--aberration-green-shift) * var(--aberration-intensity) * -1) 
        0 
        rgba(255, 100, 255, calc(0.25 * var(--aberration-intensity)))
      );
  }
}

// Phase 8.5b+: Volumetric atmospheric depth animation
// Note: Keyframes define property values, mixin consolidation applied at usage sites
@keyframes visual-effects-atmospheric-depth {
  0% {
    // Standard stack: 20px depth multiplier, 0.2/0.1 glow multipliers
    box-shadow:
      0 0 calc(var(--layered-atmospheric-depth) * 20px) rgba(var(--layered-effect-rgb), 0.2),
      inset 0 0 calc(var(--layered-atmospheric-depth) * 10px) rgba(var(--layered-effect-rgb), 0.1);
  }
  50% {
    // Peak: 30px depth multiplier, 0.3/0.15 glow multipliers
    box-shadow:
      0 0 calc(var(--layered-atmospheric-depth) * 30px) rgba(var(--layered-effect-rgb), 0.3),
      inset 0 0 calc(var(--layered-atmospheric-depth) * 15px) rgba(var(--layered-effect-rgb), 0.15);
  }
  100% {
    // Return to standard
    box-shadow:
      0 0 calc(var(--layered-atmospheric-depth) * 20px) rgba(var(--layered-effect-rgb), 0.2),
      inset 0 0 calc(var(--layered-atmospheric-depth) * 10px) rgba(var(--layered-effect-rgb), 0.1);
  }
}

// Removed: volumetric-visual-effects-pulse keyframes (breathing animations completely removed)

// Phase 4.2e: Holographic Lens Enhancement - color grading that enhances underlying visuals
@keyframes layered-lens-enhancement {
  0% {
    backdrop-filter: 
      contrast(calc(1 + var(--visual-effects-scanline-density) * 0.15))
      saturate(calc(1 + var(--visual-effects-scanline-density) * 0.2))
      brightness(calc(1 + var(--visual-effects-scanline-density) * 0.05))
      hue-rotate(calc(var(--temperature-scanline-color-shift) * 0.3));
    opacity: calc(var(--visual-effects-scanline-opacity) * (1 - var(--musical-scanline-pulse) * 0.05));
  }
  25% {
    backdrop-filter: 
      contrast(calc(1 + var(--visual-effects-scanline-density) * 0.18))
      saturate(calc(1 + var(--visual-effects-scanline-density) * 0.25))
      brightness(calc(1 + var(--visual-effects-scanline-density) * 0.08))
      hue-rotate(calc(var(--temperature-scanline-color-shift) * 0.4));
    opacity: calc(var(--visual-effects-scanline-opacity) * (1 + var(--musical-scanline-pulse) * 0.1));
  }
  50% {
    backdrop-filter: 
      contrast(calc(1 + var(--visual-effects-scanline-density) * 0.22))
      saturate(calc(1 + var(--visual-effects-scanline-density) * 0.3))
      brightness(calc(1 + var(--visual-effects-scanline-density) * 0.12))
      hue-rotate(calc(var(--temperature-scanline-color-shift) * 0.5));
    opacity: calc(var(--visual-effects-scanline-opacity) * (1 + var(--musical-scanline-pulse) * 0.15));
  }
  75% {
    backdrop-filter: 
      contrast(calc(1 + var(--visual-effects-scanline-density) * 0.18))
      saturate(calc(1 + var(--visual-effects-scanline-density) * 0.25))
      brightness(calc(1 + var(--visual-effects-scanline-density) * 0.08))
      hue-rotate(calc(var(--temperature-scanline-color-shift) * 0.4));
    opacity: calc(var(--visual-effects-scanline-opacity) * (1 + var(--musical-scanline-pulse) * 0.1));
  }
  100% {
    backdrop-filter: 
      contrast(calc(1 + var(--visual-effects-scanline-density) * 0.15))
      saturate(calc(1 + var(--visual-effects-scanline-density) * 0.2))
      brightness(calc(1 + var(--visual-effects-scanline-density) * 0.05))
      hue-rotate(calc(var(--temperature-scanline-color-shift) * 0.3));
    opacity: calc(var(--visual-effects-scanline-opacity) * (1 - var(--musical-scanline-pulse) * 0.05));
  }
}

// Removed: gentle-visual-effects-breathing keyframes (breathing animations completely removed)

// Phase 4.2c: Advanced interference patterns for high visual effects - atmospheric noise
@keyframes visual-effects-interference {
  0% {
    transform: 
      scale(calc(1 + var(--visual-effects-scanline-complexity) * 0.01)) 
      rotate(calc(var(--visual-effects-scanline-complexity) * -0.5deg));
    filter: 
      contrast(calc(1 + var(--visual-effects-scanline-complexity) * 0.05)) 
      saturate(calc(1 + var(--visual-effects-scanline-complexity) * 0.1))
      hue-rotate(calc(var(--temperature-scanline-color-shift) * 0.8));
    opacity: calc(var(--visual-effects-scanline-complexity) * 0.4);
  }
  33% {
    transform: 
      scale(calc(1 + var(--visual-effects-scanline-complexity) * 0.015)) 
      rotate(calc(var(--visual-effects-scanline-complexity) * 0.3deg));
    filter: 
      contrast(calc(1 + var(--visual-effects-scanline-complexity) * 0.08)) 
      saturate(calc(1 + var(--visual-effects-scanline-complexity) * 0.15))
      hue-rotate(calc(var(--temperature-scanline-color-shift) * 1.1));
    opacity: calc(var(--visual-effects-scanline-complexity) * 0.5);
  }
  67% {
    transform: 
      scale(calc(1 + var(--visual-effects-scanline-complexity) * 0.02)) 
      rotate(calc(var(--visual-effects-scanline-complexity) * 0.8deg));
    filter: 
      contrast(calc(1 + var(--visual-effects-scanline-complexity) * 0.1)) 
      saturate(calc(1 + var(--visual-effects-scanline-complexity) * 0.2))
      hue-rotate(calc(var(--temperature-scanline-color-shift) * 1.3));
    opacity: calc(var(--visual-effects-scanline-complexity) * 0.6);
  }
  100% {
    transform: 
      scale(calc(1 + var(--visual-effects-scanline-complexity) * 0.01)) 
      rotate(calc(var(--visual-effects-scanline-complexity) * -0.5deg));
    filter: 
      contrast(calc(1 + var(--visual-effects-scanline-complexity) * 0.05)) 
      saturate(calc(1 + var(--visual-effects-scanline-complexity) * 0.1))
      hue-rotate(calc(var(--temperature-scanline-color-shift) * 0.8));
    opacity: calc(var(--visual-effects-scanline-complexity) * 0.4);
  }
}

// ═══════════════════════════════════════════════════════════════════════════════
// 🎨 AESTHETIC MODE LAYERED PERSONALITIES
// ═══════════════════════════════════════════════════════════════════════════════

// Cosmic Mode: Deep space aesthetics with soft blues and stellar aberration
.aesthetic-mode-cosmic {
  // Cosmic aberration variables for deep space aesthetics
  --aberration-intensity: 0.6;
  --aberration-color-separation: 2.5px;
  --aberration-red-shift: 2px;
  --aberration-blue-shift: -2px;
  --aberration-green-shift: 0px;
  --aberration-wave-frequency: 2s;
  
  .layered-element {
    animation: 
      visual-effects-layered-flicker calc(1s / var(--layered-flicker-rate, 5)) ease-in-out infinite,
      visual-effects-atmospheric-depth 2s ease-in-out infinite,
      visual-effects-chromatic-aberration calc(3s / var(--layered-flicker-rate, 5)) ease-in-out infinite;
    
    &::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        repeating-linear-gradient(
          0deg,
          transparent 0px,
          transparent 3px,
          rgba(var(--layered-effect-rgb), 0.1) 4px
        );
      // Removed: breathing scanlines animation
      pointer-events: none;
    }
  }
}

// Cinematic Mode: Dramatic reds and high-contrast energy with enhanced aberration
.aesthetic-mode-cinematic {
  // Enhanced aberration variables for cinematic mode
  --aberration-intensity: 0.8;
  --aberration-color-separation: 4px;
  --aberration-red-shift: 3px;
  --aberration-blue-shift: -3px;
  --aberration-musical-sync: 1.0;
  
  .layered-element {
    animation: 
      visual-effects-layered-flicker calc(0.5s / var(--layered-flicker-rate, 8)) ease-in-out infinite,
      visual-effects-chromatic-aberration calc(2s / var(--layered-flicker-rate, 8)) ease-in-out infinite,
      musical-aberration-pulse calc(0.3s / var(--layered-flicker-rate, 10)) ease-in-out infinite;
    
    // Dramatic red energy overlay
    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        linear-gradient(45deg, 
          rgba(255, 0, 100, var(--layered-red-energy-burst-effects)) 0%,
          transparent 30%,
          transparent 70%,
          rgba(0, 255, 255, var(--layered-red-energy-burst-effects)) 100%);
      mix-blend-mode: screen;
      pointer-events: none;
    }
  }
}

// Ethereal Mode: Soft subtle elements with gentle glow and smooth aberration
.aesthetic-mode-ethereal {
  // Soft aberration variables for ethereal mode
  --aberration-intensity: 0.3;
  --aberration-color-separation: 1.5px;
  --aberration-red-shift: 1px;
  --aberration-blue-shift: -1px;
  --aberration-green-shift: 0.5px;
  --aberration-wave-frequency: 3s;
  
  .layered-element:not(.main-view-container):not(.main-view-container__scroll-node) {
    animation: 
      visual-effects-atmospheric-depth 6s ease-in-out infinite,
      visual-effects-aberration-waves calc(var(--aberration-wave-frequency)) ease-in-out infinite;
    
    filter: 
      blur(calc(var(--layered-ethereal-softness) * 0.5px))
      brightness(calc(1 + var(--layered-ethereal-softness) * 0.2));
    
    // Mystical shimmer particles
    &::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      background: 
        radial-gradient(circle at 20% 80%, rgba(var(--layered-effect-rgb), 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(var(--layered-scanline-rgb), 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(var(--layered-effect-rgb), 0.05) 0%, transparent 30%);
      // Removed: breathing animation
      pointer-events: none;
    }
  }
}

// Natural Mode: Organic earth-connected layered effects with subtle aberration
.aesthetic-mode-natural {
  // Gentle aberration variables for natural mode
  --aberration-intensity: 0.4;
  --aberration-color-separation: 2px;
  --aberration-red-shift: 1.5px;
  --aberration-blue-shift: -1.5px;
  --aberration-green-shift: 0px;
  --aberration-wave-frequency: 4s;
  
  .layered-element {
    animation: 
      visual-effects-layered-flicker calc(1.5s / var(--layered-flicker-rate, 4)) ease-in-out infinite,
      visual-effects-aberration-waves calc(var(--aberration-wave-frequency)) ease-in-out infinite;
    
    // Natural flow patterns
    &::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        linear-gradient(120deg, 
          rgba(var(--layered-effect-rgb), var(--layered-natural-warmth)) 0%,
          transparent 50%,
          rgba(var(--layered-scanline-rgb), var(--layered-natural-warmth)) 100%);
      background-size: 200% 200%;
      background-position: 0% 0%;
      animation: 
        simple-gradient-flow 10s linear infinite;
      opacity: 0.3;
      pointer-events: none;
    }
  }
}

// ═══════════════════════════════════════════════════════════════════════════════
// 🎵 MUSICAL VISUAL INTEGRATION
// ═══════════════════════════════════════════════════════════════════════════════

// Enhanced layered response during musical peaks
.music-energy-high {
  .layered-element {
    --layered-music-flicker-intensity: 0.8;
    animation-duration: calc(0.3s / var(--layered-flicker-rate, 10)) !important;
  }
}

.music-energy-medium {
  .layered-element {
    --layered-music-flicker-intensity: 0.5;
  }
}

.music-energy-low {
  .layered-element {
    --layered-music-flicker-intensity: 0.2;
    animation-duration: calc(2s / var(--layered-flicker-rate, 3)) !important;
  }
}

// Beat-synchronized layered pulses
.beat-detected {
  .layered-element {
    animation: 
      visual-effects-layered-flicker 0.1s ease-out,
      visual-effects-atmospheric-depth 2s ease-in-out infinite !important;
  }
}

// ═══════════════════════════════════════════════════════════════════════════════
// 🛸 ENHANCED SPOTIFY UI LAYERED INTEGRATION
// ═══════════════════════════════════════════════════════════════════════════════

// Main view containers with visual effects layered
.main-view-container {
  @extend .layered-element !optional;
  
  // Phase 4.2a: Volumetric 3D visual effects container
  perspective: var(--layered-perspective-depth);
  transform-style: preserve-3d;
  
  // Subtle translucent layered overlay with volumetric depth
  background: 
    rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * 0.05)),
    linear-gradient(135deg, 
      transparent 0%, 
      rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * 0.02)) 50%,
      transparent 100%);
  // border: 1px solid rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * 0.3)); // Removed to eliminate visible rectangle
  
  // Volumetric depth transform based on visual effects level
  transform: translateZ(calc(var(--layered-depth-offset) * var(--volumetric-depth-intensity)));

  // Phase 8.5b+: Use consolidated volumetric-shadow mixin (full 3-layer stack)
  @include volumetric-shadow($depth-multiplier: 25px, $glow-multiplier: 1, $stack-type: 'full');
  
  // Phase 4.2e: Depth Visual Enhancement Lens - Content-aware layered enhancement
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 1;
    
    // Content-aware positioning - enhanced effects only in edge areas to preserve readability
    clip-path: polygon(
      0% 0%, 100% 0%, 100% 15%,    /* Top edge enhancement */
      85% 15%, 85% 85%,            /* Right edge enhancement */  
      100% 85%, 100% 100%, 0% 100%, /* Bottom enhancement */
      0% 85%, 15% 85%, 15% 15%,    /* Left edge enhancement */
      0% 15%                       /* Back to start - creates frame effect */
    );
    
    // Gentle enhancement that doesn't interfere with content reading
    backdrop-filter: 
      contrast(calc(1 + var(--visual-effects-scanline-density, 0.5) * 0.03))
      saturate(calc(1 + var(--visual-effects-scanline-density, 0.5) * 0.05))
      brightness(calc(1 + var(--visual-effects-scanline-density, 0.5) * 0.01));
    
    // Edge-focused layered zones that frame content beautifully
    background: 
      radial-gradient(
        ellipse 100px 60px at 10% 20%, 
        hsla(calc(180 + var(--temperature-scanline-color-shift, 0)), 60%, 70%, calc(var(--visual-effects-scanline-opacity, 0.15) * 0.04)) 0%,
        transparent 70%
      ),
      radial-gradient(
        ellipse 100px 60px at 90% 80%, 
        hsla(calc(200 + var(--temperature-scanline-color-shift, 0)), 70%, 60%, calc(var(--visual-effects-scanline-opacity, 0.15) * 0.04)) 0%,
        transparent 70%
      );
    
    // Subtle enhancement blend mode
    mix-blend-mode: color-dodge;
    
    // Reading-mode aware opacity - fades during active reading
    opacity: calc(
      var(--visual-effects-scanline-opacity, 0.15) * 0.3 * 
      (1 - var(--reading-mode-active, 0) * 0.8) *
      (1 - var(--user-interaction-detected, 0) * 0.3)
    );
    
    // Removed: gentle visual effects breathing animation
    
    // Ensure no blur overlay effects
    filter: none;
  }
  
  // Additional enhancement layer for high visual effects levels
  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 2;
    opacity: calc(var(--visual-effects-scanline-complexity) * 0.3);
    
    // Advanced color grading enhancement
    backdrop-filter: 
      sepia(calc(var(--visual-effects-scanline-complexity) * 0.1))
      contrast(calc(1 + var(--visual-effects-scanline-complexity) * 0.1))
      saturate(calc(1 + var(--visual-effects-scanline-complexity) * 0.15));
    
    // Holographic lens edge enhancement
    background: 
      linear-gradient(
        45deg,
        transparent 0%,
        hsla(calc(220 + var(--temperature-scanline-color-shift)), 80%, 60%, calc(var(--visual-effects-scanline-complexity) * 0.03)) 30%,
        transparent 70%,
        hsla(calc(160 + var(--temperature-scanline-color-shift)), 80%, 60%, calc(var(--visual-effects-scanline-complexity) * 0.02)) 85%,
        transparent 100%
      );
    
    // Lens edge enhancement blend
    mix-blend-mode: overlay;
    
    // Only active for high visual effects
    animation-play-state: var(--visual-effects-scanline-interference);
  }
}

// Navigation bar with data stream layered effects
.Root__nav-bar {
  @extend .layered-element !optional;
  
  position: relative;
  
  // Breathing removed - functional navigation, not emotional element
  
  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      repeating-linear-gradient(
        90deg,
        transparent 0px,
        rgba(var(--layered-scanline-rgb), 0.1) 2px,
        transparent 4px,
        transparent 20px
      );
    background-size: 40px 100%;
    animation: 
      simple-gradient-flow 4s linear infinite;
    pointer-events: none;
  }
}

// Now playing bar with visual effects layered
.Root__now-playing-bar {
  @extend .layered-element !optional;
  
  // Breathing removed from bar - targeting specific music elements instead
  
  // Phase 4.2a: Volumetric depth for now playing visual effects
  transform: translateZ(calc(var(--layered-depth-offset) * var(--volumetric-depth-intensity) * 1.2));

  // Phase 8.5b+: Use consolidated volumetric-shadow mixin (enhanced 3-layer stack with 1.2x multipliers)
  @include volumetric-shadow($depth-multiplier: 25px, $glow-multiplier: 1, $stack-type: 'enhanced');
  
  // Enhanced pulsing during visual effects peaks with volumetric breathing
  &[data-visual-effects-level="high"] {
    animation: 
      visual-effects-atmospheric-depth 0.5s ease-in-out infinite;
  }
}

// Track rows with layered breathing
.main-view-container__scroll-node {
  @extend .layered-element !optional;
  
  .main-trackList-trackListRow {
    transition: all 0.3s ease-out;
    
    &:hover,
    &.main-trackList-selected {
      background: rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * 0.1));
      // Phase 8.5b+: Use consolidated volumetric-shadow mixin (standard 2-layer stack)
      @include volumetric-shadow($depth-multiplier: 18.75px, $glow-multiplier: 0.75, $stack-type: 'standard');

      // Removed: breathing effect on selected/hovered tracks
    }
  }
}

// Sidebar with dimensional nexus layered effects
.Root__main-view .main-view-container__scroll-node-child {
  @extend .layered-element !optional;
  
  // Scanline overlay for authentic CRT feel
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      repeating-linear-gradient(
        0deg,
        transparent 0px,
        transparent 1px,
        rgba(var(--layered-scanline-rgb), calc(var(--layered-glow-intensity) * 0.08)) 2px,
        rgba(var(--layered-scanline-rgb), calc(var(--layered-glow-intensity) * 0.08)) 2px
      );
    // Removed: breathing scanlines animation
    pointer-events: none;
    opacity: 0.6;
  }
}

// ═══════════════════════════════════════════════════════════════════════════════
// 📖 READING MODE VISUAL ENHANCEMENTS
// ═══════════════════════════════════════════════════════════════════════════════

// ═══════════════════════════════════════════════════════════════════════════════
// 🌈 ADVANCED MULTI-LAYER ABERRATION TECHNIQUES
// ═══════════════════════════════════════════════════════════════════════════════

// Enhanced aberration for high visual effects levels with multi-layer effects
.layered-element[data-visual-effects-level="high"],
.layered-element[style*="--aberration-intensity"][style*="0.7"] {
  position: relative;
  
  // Secondary aberration layer - enhanced RGB splitting
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: -1;
    
    // Sophisticated multi-directional aberration
    background: 
      linear-gradient(
        45deg,
        rgba(255, 50, 50, calc(var(--aberration-intensity, 0.5) * 0.1)) 0%,
        transparent 30%,
        transparent 70%,
        rgba(50, 150, 255, calc(var(--aberration-intensity, 0.5) * 0.1)) 100%
      );
    
    // Multi-axis chromatic shift
    filter: 
      drop-shadow(
        calc(var(--aberration-red-shift, 2px) * 0.5) 
        calc(var(--aberration-red-shift, 2px) * 0.3) 
        0 
        rgba(255, 0, 0, calc(var(--aberration-intensity, 0.5) * 0.2))
      )
      drop-shadow(
        calc(var(--aberration-blue-shift, -2px) * 0.7) 
        calc(var(--aberration-blue-shift, -2px) * -0.2) 
        0 
        rgba(0, 100, 255, calc(var(--aberration-intensity, 0.5) * 0.2))
      );
    
    // Movement synchronized with visual effects
    animation: 
      visual-effects-aberration-waves calc(var(--aberration-wave-frequency, 2s)) ease-in-out infinite,
      visual-effects-chromatic-aberration calc(var(--aberration-wave-frequency, 2s) * 1.5) ease-in-out infinite;
  }
  
  // Tertiary aberration layer - fine detail enhancement
  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: -2;
    
    // Subtle color gradient bleeding
    background: 
      radial-gradient(
        ellipse 200px 100px at 30% 70%, 
        rgba(var(--layered-effect-rgb), calc(var(--aberration-intensity, 0.5) * 0.08)) 0%,
        transparent 60%
      ),
      radial-gradient(
        ellipse 150px 200px at 70% 30%, 
        rgba(var(--layered-scanline-rgb), calc(var(--aberration-intensity, 0.5) * 0.06)) 0%,
        transparent 60%
      );
    
    // Advanced directional aberration
    filter: 
      drop-shadow(
        calc(var(--aberration-green-shift, 0px) * 2) 
        calc(var(--aberration-red-shift, 2px) * -0.5) 
        0 
        rgba(100, 255, 100, calc(var(--aberration-intensity, 0.5) * 0.15))
      );
    
    // Complex wave motion
    animation: 
      musical-aberration-pulse calc(var(--aberration-wave-frequency, 2s) * 0.7) ease-in-out infinite;
    
    // Blend mode for sophisticated color interaction
    mix-blend-mode: color-dodge;
  }
}

// High-energy aberration for beat detection
.beat-detected .layered-element,
.music-energy-high .layered-element {
  // Temporary aberration boost during beats
  --aberration-intensity: calc(var(--aberration-intensity, 0.5) * 1.4);
  --aberration-color-separation: calc(var(--aberration-color-separation, 3px) * 1.2);
  
  // Enhanced multi-layer effects during beats
  &::before,
  &::after {
    animation-duration: calc(var(--aberration-wave-frequency, 2s) * 0.3) !important;
  }
}

// Consciousness-aware aberration scaling
@media (min-width: 1200px) and (min-height: 800px) {
  // Enhanced effects for larger screens
  .layered-element {
    --aberration-color-separation: calc(var(--aberration-color-separation, 3px) * 1.2);
    --aberration-red-shift: calc(var(--aberration-red-shift, 2px) * 1.1);
    --aberration-blue-shift: calc(var(--aberration-blue-shift, -2px) * 1.1);
  }
}

@media (max-width: 768px) {
  // Reduced effects for mobile performance
  .layered-element {
    --aberration-intensity: calc(var(--aberration-intensity, 0.5) * 0.7);
    --aberration-color-separation: calc(var(--aberration-color-separation, 3px) * 0.8);
    
    &::before,
    &::after {
      display: none; // Disable multi-layer effects on mobile
    }
  }
}

// Enhanced text clarity during active reading sessions
.main-view-container[data-reading-mode="active"],
.main-view-container[style*="--reading-mode-active: 1"] {
  // Reduce layered interference during reading
  &::before {
    opacity: calc(var(--visual-effects-scanline-opacity, 0.15) * 0.1);
    animation-duration: 8s; // Slower animation
  }
  
  &::after {
    opacity: calc(var(--visual-effects-scanline-complexity) * 0.05);
  }
  
  // Enhance text contrast and readability
  backdrop-filter: 
    contrast(1.1) 
    brightness(1.02) 
    saturate(0.95); // Slightly reduce saturation for easier reading
  
  // Ensure text content is clear
  .main-trackList-trackListRow,
  .main-entityHeader-titleText,
  .main-entityHeader-subtitle,
  .Type__TypeElement {
    text-shadow: 
      0 0 1px rgba(0, 0, 0, 0.8),
      0 0 2px rgba(0, 0, 0, 0.4);
    backdrop-filter: contrast(1.15);
  }
}

// Content-aware layered zones - minimal effects in text-heavy areas
.main-view-container .main-trackList-trackList,
.main-view-container .main-entityHeader,
.main-view-container [class*="lyrics"] {
  // Reduce layered effects in text-heavy content areas
  &::before {
    opacity: calc(var(--visual-effects-scanline-opacity, 0.15) * 0.05);
    clip-path: polygon(
      0% 0%, 100% 0%, 100% 5%,    /* Minimal top edge */
      95% 5%, 95% 95%,            /* Minimal right edge */  
      100% 95%, 100% 100%, 0% 100%, /* Minimal bottom */
      0% 95%, 5% 95%, 5% 5%,      /* Minimal left edge */
      0% 5%                       /* Back to start - minimal frame */
    );
  }
}

// ═══════════════════════════════════════════════════════════════════════════════
// ⚡ PERFORMANCE & ACCESSIBILITY CONSCIOUSNESS
// ═══════════════════════════════════════════════════════════════════════════════

// Reduced motion accessibility
@media (prefers-reduced-motion: reduce) {
  .layered-element {
    animation: none !important;
    
    &::before,
    &::after {
      animation: none !important;
    }
  }
  
  // Static layered glow only
  .main-view-container,
  .Root__now-playing-bar {
    box-shadow: 
      0 0 10px rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * 0.5)),
      inset 0 0 5px rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * 0.2));
  }
}

// Mobile performance optimization
@media (max-width: 768px) {
  :root {
    --layered-atmospheric-depth-mobile: calc(var(--layered-atmospheric-depth) * 0.7);
    --layered-chromatic-shift-mobile: calc(var(--layered-chromatic-shift) * 0.5);
  }
  
  .layered-element {
    animation-duration: 4s !important;
    
    &::before,
    &::after {
      opacity: calc(var(--layered-glow-intensity) * 0.5) !important;
    }
  }
}

// High contrast accessibility
@media (prefers-contrast: high) {
  :root {
    --layered-glow-intensity-contrast: 0.8;
    --layered-atmospheric-depth-contrast: 0.6;
  }
  
  .layered-element {
    // border: 2px solid rgba(var(--layered-effect-rgb), 0.8) !important; // Removed to eliminate visible rectangle
    box-shadow: 
      0 0 20px rgba(var(--layered-effect-rgb), 0.6),
      inset 0 0 10px rgba(var(--layered-effect-rgb), 0.3) !important;
  }
}

// ==============================================
// Legacy Compatibility Aliases
// ==============================================
// Ensures backward compatibility during transition

// Keyframe aliases for legacy animation names
@keyframes visual-layered-flicker {
  0% {
    opacity: var(--layered-glow-intensity);
    filter: 
      drop-shadow(0 0 5px rgba(var(--layered-effect-rgb), 0.4))
      hue-rotate(0deg);
  }
  50% {
    opacity: calc(var(--layered-glow-intensity) * 0.7);
    filter: 
      drop-shadow(0 0 8px rgba(var(--layered-effect-rgb), 0.6))
      hue-rotate(10deg);
  }
  100% {
    opacity: var(--layered-glow-intensity);
    filter: 
      drop-shadow(0 0 5px rgba(var(--layered-effect-rgb), 0.4))
      hue-rotate(0deg);
  }
}

@keyframes visual-chromatic-aberration {
  0% { transform: translateX(0); }
  25% { transform: translateX(var(--aberration-red-shift)); }
  50% { transform: translateX(0); }
  75% { transform: translateX(var(--aberration-blue-shift)); }
  100% { transform: translateX(0); }
}

@keyframes natural-aberration-waves {
  0% { transform: translateY(0) scaleY(1); }
  50% { transform: translateY(2px) scaleY(0.98); }
  100% { transform: translateY(0) scaleY(1); }
}

@keyframes visual-atmospheric-depth {
  0% { transform: translateZ(0); opacity: 1; }
  50% { transform: translateZ(var(--visual-effects-depth-offset)); opacity: 0.9; }
  100% { transform: translateZ(0); opacity: 1; }
}

@keyframes natural-visual-interference {
  0% { filter: opacity(1); }
  33% { filter: opacity(0.9); }
  66% { filter: opacity(0.95); }
  100% { filter: opacity(1); }
}

// ═══════════════════════════════════════════════════════════════════════════════
// 🌊 VISUAL EFFECTS COMPLETION
// "The layered interface now flows with the essence of color itself."
// ═══════════════════════════════════════════════════════════════════════════════