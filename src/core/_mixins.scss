// StarryNight Shared Mixins
// Common SCSS mixins used across StarryNight modules
@forward "dom_selectors";
@use "_design_tokens" as *;

// Performance optimization mixin for hardware acceleration
@mixin hardware-accelerated {
  will-change: transform, opacity, filter;
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

// Animation base mixin for smooth transitions
@mixin smooth-transition($duration: 0.8s, $timing: ease-in-out) {
  transition: all $duration $timing;
}

// Container optimization for performance
@mixin contain-optimized {
  // Remove layout containment to prevent lazy-load bug causing images to stay blank after scroll.
  contain: style paint;
}

// Combined performance optimizations
@mixin performance-optimized {
  @include hardware-accelerated;
  @include contain-optimized;
}

// ═══════════════════════════════════════════════════════════════════════════════
// 🌊 UNIFIED BREATHING ANIMATION SYSTEM (Phase 2)
// Consolidated breathing animations with design system integration
// ═══════════════════════════════════════════════════════════════════════════════

// Base breathing animation mixin with performance optimization
@mixin breathing-animation-base($duration-var: --sn-anim-transition-cosmic, $easing-var: --sn-anim-easing-organic) {
  @include performance-optimized;
  animation-duration: var(#{$duration-var}, 4000ms);
  animation-timing-function: var(#{$easing-var}, ease-in-out);
  animation-iteration-count: infinite;
  animation-fill-mode: both;
  
  // Accessibility support
  @media (prefers-reduced-motion: reduce) {
    animation: none !important;
    transform: translateZ(0) scale(1) !important;
    opacity: var(--sn-ui-glass-opacity, 1) !important;
    filter: none !important;
  }
}

// Unified breathing animation mixin - generates keyframes and applies animation
@mixin breathing-animation(
  $variant: 'gentle',
  $duration-var: --sn-anim-transition-cosmic,
  $easing-var: --sn-anim-easing-organic,
  $intensity-scale: 1.0
) {
  @include breathing-animation-base($duration-var, $easing-var);
  
  @if $variant == 'gentle' {
    animation-name: breathing-gentle;
    // Gentle breathing keyframes - subtle effects for content areas (NO SCALING)
    @keyframes breathing-gentle {
      0%, 100% {
        transform: translateZ(0);
        opacity: calc(var(--sn-ui-glass-opacity, 0.1) * 0.95 * #{$intensity-scale});
        filter:
          brightness(var(--sn-bg-gradient-brightness, 1.0))
          saturate(var(--sn-bg-gradient-saturation, 1.1))
          contrast(var(--sn-bg-gradient-contrast, 1.0));
      }
      50% {
        transform: translateZ(0);
        opacity: calc(var(--sn-ui-glass-opacity, 0.1) * 1.05 * #{$intensity-scale});
        filter:
          brightness(calc(var(--sn-bg-gradient-brightness, 1.0) * (1 + 0.03 * #{$intensity-scale})))
          saturate(calc(var(--sn-bg-gradient-saturation, 1.1) * (1 + 0.08 * #{$intensity-scale})))
          contrast(calc(var(--sn-bg-gradient-contrast, 1.0) * (1 + 0.02 * #{$intensity-scale})));
      }
    }
  } @else if $variant == 'energetic' {
    animation-name: breathing-energetic;
    animation-duration: calc(var(#{$duration-var}, 4000ms) * 0.6);
    // Energetic breathing keyframes - enhanced effects for high energy (NO SCALING)
    @keyframes breathing-energetic {
      0%, 100% {
        transform: translateZ(0);
        opacity: calc(var(--sn-ui-glass-opacity, 0.1) * 0.9 * #{$intensity-scale});
        filter:
          brightness(var(--sn-bg-gradient-brightness, 1.0))
          saturate(var(--sn-bg-gradient-saturation, 1.1))
          contrast(var(--sn-bg-gradient-contrast, 1.0));
      }
      50% {
        transform: translateZ(0);
        opacity: calc(var(--sn-ui-glass-opacity, 0.1) * 1.15 * #{$intensity-scale});
        filter:
          brightness(calc(var(--sn-bg-gradient-brightness, 1.0) * (1 + 0.08 * #{$intensity-scale})))
          saturate(calc(var(--sn-bg-gradient-saturation, 1.1) * (1 + 0.25 * #{$intensity-scale})))
          contrast(calc(var(--sn-bg-gradient-contrast, 1.0) * (1 + 0.08 * #{$intensity-scale})));
      }
    }
  } @else if $variant == 'meditative' {
    animation-name: breathing-meditative;
    animation-duration: calc(var(#{$duration-var}, 4000ms) * 1.5);
    // Meditative breathing keyframes - minimal effects for calm music (NO SCALING)
    @keyframes breathing-meditative {
      0%, 100% {
        transform: translateZ(0);
        opacity: calc(var(--sn-ui-glass-opacity, 0.1) * 0.85 * #{$intensity-scale});
      }
      50% {
        transform: translateZ(0);
        opacity: calc(var(--sn-ui-glass-opacity, 0.1) * 0.95 * #{$intensity-scale});
      }
    }
  } @else if $variant == 'cosmic' {
    animation-name: breathing-cosmic;
    animation-duration: calc(var(#{$duration-var}, 4000ms) * 0.75);
    // Cosmic breathing keyframes - maximum effects for dramatic moments (NO SCALING)
    @keyframes breathing-cosmic {
      0%, 100% {
        transform: translateZ(0);
        opacity: calc(var(--sn-ui-glass-opacity, 0.1) * 0.88 * #{$intensity-scale});
        filter:
          brightness(var(--sn-bg-gradient-brightness, 1.0))
          saturate(var(--sn-bg-gradient-saturation, 1.1))
          contrast(var(--sn-bg-gradient-contrast, 1.0));
      }
      50% {
        transform: translateZ(0);
        opacity: calc(var(--sn-ui-glass-opacity, 0.1) * 1.25 * #{$intensity-scale});
        filter:
          brightness(calc(var(--sn-bg-gradient-brightness, 1.0) * (1 + 0.12 * #{$intensity-scale})))
          saturate(calc(var(--sn-bg-gradient-saturation, 1.1) * (1 + 0.4 * #{$intensity-scale})))
          contrast(calc(var(--sn-bg-gradient-contrast, 1.0) * (1 + 0.1 * #{$intensity-scale})))
          hue-rotate(calc(var(--sn-music-rhythm-phase, 0deg) * 0.08 * #{$intensity-scale}));
      }
    }
  } @else if $variant == 'depth' {
    animation-name: breathing-depth;
    // Depth breathing keyframes - backdrop-filter based for depth layers
    @keyframes breathing-depth {
      0%, 100% {
        transform: translateZ(0);
        opacity: calc(var(--depth-effects-intensity, 0.5) * 0.6 * #{$intensity-scale});
        backdrop-filter:
          contrast(calc(1 + var(--depth-effects-intensity, 0.5) * 0.02 * #{$intensity-scale}))
          saturate(calc(1 + var(--depth-effects-intensity, 0.5) * 0.03 * #{$intensity-scale}));
      }
      50% {
        transform: translateZ(0);
        opacity: calc(var(--depth-effects-intensity, 0.5) * 0.8 * #{$intensity-scale});
        backdrop-filter:
          contrast(calc(1 + var(--depth-effects-intensity, 0.5) * 0.05 * #{$intensity-scale}))
          saturate(calc(1 + var(--depth-effects-intensity, 0.5) * 0.08 * #{$intensity-scale}));
      }
    }
  }
}

// ═══════════════════════════════════════════════════════════════════════════════
// 💎 UNIFIED CRYSTALLINE GLASSMORPHISM SYSTEM (Phase 3)
// Enhanced glassmorphism with crystalline effects and prismatic lighting
// ═══════════════════════════════════════════════════════════════════════════════

// Prismatic edge lighting mixin for crystalline effects
@mixin prismatic-edge-lighting($intensity: 0.4, $speed: 8s) {
  position: relative;
  
  &::before {
    content: "";
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(
      45deg,
      rgba(255, 0, 0, #{$intensity}) 0%,
      rgba(255, 255, 0, #{$intensity}) 16.66%,
      rgba(0, 255, 0, #{$intensity}) 33.33%,
      rgba(0, 255, 255, #{$intensity}) 50%,
      rgba(0, 0, 255, #{$intensity}) 66.66%,
      rgba(255, 0, 255, #{$intensity}) 83.33%,
      rgba(255, 0, 0, #{$intensity}) 100%
    );
    border-radius: inherit;
    z-index: -1;
    animation: prismatic-rainbow-flow #{$speed} linear infinite;
    filter: blur(1px);
  }
  
  @keyframes prismatic-rainbow-flow {
    0% { filter: hue-rotate(0deg) blur(1px); }
    25% { filter: hue-rotate(90deg) blur(1px); }
    50% { filter: hue-rotate(180deg) blur(1px); }
    75% { filter: hue-rotate(270deg) blur(1px); }
    100% { filter: hue-rotate(360deg) blur(1px); }
  }
}

// Enhanced glassmorphism with crystalline effects
@mixin glassmorphism-crystalline(
  $blur: 20px, 
  $opacity: 0.08, 
  $saturation: 1.2,
  $intensity: 0.6,
  $float-height: 15px,
  $animation-speed: 4s
) {
  @include performance-optimized;
  position: relative;
  
  // Enhanced backdrop filter with crystalline properties
  backdrop-filter: 
    blur(#{$blur}) 
    brightness(calc(var(--sn-bg-gradient-brightness, 1.0) * 1.1)) 
    contrast(1.1) 
    saturate(#{$saturation});
  -webkit-backdrop-filter: 
    blur(#{$blur}) 
    brightness(calc(var(--sn-bg-gradient-brightness, 1.0) * 1.1)) 
    contrast(1.1) 
    saturate(#{$saturation});
    
  // Crystal-like border
  border: 1px solid rgba(var(--sn-musical-oklab-accent-rgb), 0.2);
  
  // Layered crystalline background
  background: 
    // Primary crystal surface using design system
    linear-gradient(
      135deg,
      rgba(var(--sn-musical-oklab-primary-rgb), #{$opacity}) 0%,
      rgba(var(--sn-musical-oklab-accent-rgb), calc(#{$opacity} * 1.5)) 50%,
      rgba(var(--sn-musical-oklab-secondary-rgb), calc(#{$opacity} * 0.75)) 100%
    ),
    // Iridescent overlay
    linear-gradient(
      45deg,
      transparent 0%,
      rgba(var(--sn-musical-oklab-highlight-rgb), calc(#{$opacity} * 0.375)) 25%,
      rgba(var(--sn-musical-oklab-accent-rgb), calc(#{$opacity} * 0.625)) 50%,
      rgba(var(--sn-musical-oklab-highlight-rgb), calc(#{$opacity} * 0.375)) 75%,
      transparent 100%
    );
  
  background-size: 100% 100%, 300% 300%;
  
  // Crystalline box shadow with design system colors
  box-shadow: 
    inset 0 1px 0 rgba(var(--sn-musical-oklab-highlight-rgb), 0.1),
    inset 0 -1px 0 rgba(0, 0, 0, 0.1),
    0 calc(#{$float-height} * 2) 60px rgba(var(--sn-musical-oklab-accent-rgb), calc(#{$intensity} * 0.25)),
    0 0 20px rgba(var(--sn-musical-oklab-accent-rgb), calc(#{$intensity} * 0.17));
  
  // Crystalline animations
  animation: 
    crystalline-pulse #{$animation-speed} ease-in-out infinite,
    crystalline-iridescence calc(#{$animation-speed} * 2) linear infinite;
  
  // Crystal facet reflections
  &::before {
    content: "";
    position: absolute;
    top: 2px;
    left: 2px;
    right: 2px;
    height: 40%;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.08) 0%,
      rgba(255, 255, 255, 0.02) 50%,
      transparent 100%
    );
    border-radius: inherit;
    pointer-events: none;
    z-index: 1;
  }
  
  // Crystal internal refraction
  &::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      radial-gradient(
        ellipse at 30% 20%,
        rgba(var(--sn-musical-oklab-accent-rgb), calc(#{$opacity} * 0.75)) 0%,
        transparent 60%
      ),
      radial-gradient(
        ellipse at 70% 80%,
        rgba(var(--sn-musical-oklab-primary-rgb), calc(#{$opacity} * 0.5)) 0%,
        transparent 50%
      );
    border-radius: inherit;
    pointer-events: none;
    z-index: 0;
    // Phase 8.5b: Use unified shimmer system (gradient type for dual-layer movement)
    @include unified-shimmer($type: 'gradient', $intensity: 'normal');
    animation-duration: calc(#{$animation-speed} * 1.5);
  }
  
  // Enhanced hover state
  &:hover {
    transform: translateY(calc(-#{$float-height})) scale(1.02);
    backdrop-filter: 
      blur(calc(#{$blur} + 5px)) 
      brightness(calc(var(--sn-bg-gradient-brightness, 1.0) * 1.2)) 
      contrast(1.2) 
      saturate(1.4);
    
    box-shadow: 
      inset 0 1px 0 rgba(255, 255, 255, 0.15),
      inset 0 -1px 0 rgba(0, 0, 0, 0.05),
      0 calc(#{$float-height} * 3) 80px rgba(var(--sn-musical-oklab-accent-rgb), calc(#{$intensity} * 0.42)),
      0 0 40px rgba(var(--sn-musical-oklab-accent-rgb), calc(#{$intensity} * 0.33)),
      0 0 60px rgba(var(--sn-musical-oklab-accent-rgb), calc(#{$intensity} * 0.17));
    
    &::before {
      background: linear-gradient(
        180deg,
        rgba(255, 255, 255, 0.12) 0%,
        rgba(255, 255, 255, 0.06) 50%,
        transparent 100%
      );
    }
    
    &::after {
      animation-duration: calc(#{$animation-speed} * 0.8);
    }
  }
  
  // Fallback for unsupported browsers
  @supports not (backdrop-filter: blur(1px)) {
    background: rgba(var(--spice-rgb-surface0), calc(#{$opacity} * 3));
    border: 1px solid rgba(var(--spice-rgb-surface1), 0.3);
  }
}

// Crystalline keyframe animations
@keyframes crystalline-pulse {
  0%, 100% {
    filter: brightness(1) saturate(1.2);
    opacity: 0.8;
  }
  25% {
    filter: brightness(1.05) saturate(1.3);
    opacity: 0.9;
  }
  50% {
    filter: brightness(1.1) saturate(1.4);
    opacity: 1.0;
  }
  75% {
    filter: brightness(1.05) saturate(1.3);
    opacity: 0.9;
  }
}

@keyframes crystalline-iridescence {
  0% { background-position: 0% 50%, 0% 50%; }
  25% { background-position: 100% 0%, 100% 0%; }
  50% { background-position: 50% 100%, 50% 100%; }
  75% { background-position: 0% 50%, 0% 50%; }
  100% { background-position: 0% 50%, 0% 50%; }
}

// REMOVED (Phase 8.5b): crystalline-shimmer → consolidated into unified-shimmer($type: 'gradient')

// PHASE 1: Glassmorphism Foundation Mixins
// =============================================================================

// Core glassmorphism effect with performance optimization
@mixin glassmorphism($blur: 6px, $opacity: 0.1, $saturation: 1.2) {
  // Main glassmorphism properties first
  backdrop-filter: blur($blur) saturate($saturation);
  -webkit-backdrop-filter: blur($blur) saturate($saturation); // Safari support
  background: oklab-color('highlight', $opacity);
  border: 1px solid #{oklab-color('highlight', 0.2)};

  // Integrate with existing hardware acceleration
  @include hardware-accelerated;

  // Graceful fallback for unsupported browsers (nested rule comes last)
  @supports not (backdrop-filter: blur(1px)) {
    background: rgba(var(--spice-rgb-surface0), calc($opacity * 2));
    border: 1px solid rgba(var(--spice-rgb-surface1), 0.3);
  }
}

// Dynamic glassmorphism using CSS variables (integrates with existing gradient system)
@mixin glassmorphism-dynamic {
  // ALL CSS declarations first, before any nested rules
  // Phase 3: Beat-Sync Glass Effects - Dynamic blur modulation
  backdrop-filter: blur(calc(var(--glass-blur, 6px) + var(--sn-glass-beat-boost, 0) * 5px))
    saturate(var(--glass-saturation, 1.2))
    brightness(var(--glass-brightness, 1.1));
  -webkit-backdrop-filter: blur(calc(var(--glass-blur, 6px) + var(--sn-glass-beat-boost, 0) * 5px))
    saturate(var(--glass-saturation, 1.2))
    brightness(var(--glass-brightness, 1.1));
  background: var(
    --glass-background,
    #{oklab-color('highlight', 0.1)}
  );
  border: 1px solid
    var(
      --glass-border,
      #{oklab-color('highlight', 0.2)}
    );
  // Phase 3: Beat-Sync Glass Effects - Optimized transitions for smooth beat pulses
  transition: backdrop-filter 400ms ease-out,
              -webkit-backdrop-filter 400ms ease-out,
              background var(--sn-bg-gradient-transition, 0.8s ease-in-out),
              border var(--sn-bg-gradient-transition, 0.8s ease-in-out);

  // Include performance optimizations (these don't contain nested rules)
  @include performance-optimized;
  
  // Phase 3: Beat-Sync Glass Effects - GPU acceleration for smooth beat pulses
  will-change: backdrop-filter, -webkit-backdrop-filter;

  // Enhanced fallback using existing Catppuccin variables (nested rule comes last)
  @supports not (backdrop-filter: blur(1px)) {
    background: rgba(
      var(--spice-rgb-surface0),
      var(--glass-opacity-fallback, 0.2)
    );
    border: 1px solid rgba(var(--spice-rgb-surface1), 0.3);
  }
}

// Layered glassmorphism for depth effects
@mixin glassmorphism-layered($layer: 1) {
  @if $layer == 1 {
    z-index: 1;
    @include glassmorphism(4px, 0.08, 1.1);
  } @else if $layer == 2 {
    z-index: 2;
    @include glassmorphism(6px, 0.12, 1.3);
  } @else if $layer == 3 {
    z-index: 3;
    @include glassmorphism(8px, 0.15, 1.5);
  }
}

// PHASE 2: 3D Transition Infrastructure
// =============================================================================

// Enhanced transition system for card interactions
@mixin card-transition($duration: 0.4s, $timing: var(--sn-transition-timing-default, var(--sn-anim-easing-standard))) {
  transition: transform $duration $timing, box-shadow $duration $timing,
    background-color $duration $timing, backdrop-filter $duration $timing,
    opacity $duration $timing;
}

// 3D transform preparation (preparing for Phase 3)
@mixin transform-3d-prep {
  transform-style: preserve-3d;
  perspective: 1000px;
  backface-visibility: hidden;
}

// Interactive element scaling
@mixin interactive-scale($scale: 1.02) {
  transform: scale($scale) translateZ(0);
}

// Advanced card states system
@mixin card-state-base {
  // ALL CSS declarations must come first, before any @include or nested rules
  position: relative;
  overflow: hidden;
  transform-style: preserve-3d;
  perspective: 1000px;
  backface-visibility: hidden;

  // Now include mixins that may contain nested rules
  @include performance-optimized;
  @include card-transition;

  // Interactive state indicators
  &::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      135deg,
      transparent 0%,
      #{oklab-color('highlight', 0.05)} 50%,
      transparent 100%
    );
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 1;
  }

  &:hover::before {
    opacity: 1;
  }
}

// PHASE 3: 3D Morphing & Advanced Transform Systems
// =============================================================================

// True 3D perspective container
@mixin perspective-container($perspective: 1200px) {
  perspective: $perspective;
  perspective-origin: center center;
  transform-style: preserve-3d;
}

// 3D card transform with rotation and depth
@mixin card-3d-transform(
  $rotateX: 0deg,
  $rotateY: 0deg,
  $translateZ: 0px,
  $scale: 1
) {
  transform: perspective(1200px) translateZ($translateZ) scale($scale);
  transform-style: preserve-3d;
  backface-visibility: hidden;
}

// Morphing animation system for card state changes
@mixin morphing-transition(
  $duration: 0.8s,
  $timing: var(--sn-transition-timing-default, var(--sn-anim-easing-organic))
) {
  transition: transform $duration $timing, background $duration $timing,
    backdrop-filter $duration $timing, box-shadow $duration $timing,
    border-radius $duration $timing, opacity $duration $timing;
}

// Layered depth system for complex 3D scenes
@mixin depth-layer($layer: 1) {
  @if $layer == 1 {
    transform: translateZ(10px);
    z-index: 1;
  } @else if $layer == 2 {
    transform: translateZ(20px);
    z-index: 2;
  } @else if $layer == 3 {
    transform: translateZ(40px);
    z-index: 3;
  } @else if $layer == 4 {
    transform: translateZ(60px);
    z-index: 4;
  } @else if $layer == 5 {
    transform: translateZ(80px);
    z-index: 5;
  }
}

// Improved layered depth effect with dynamic calculation (replaces holographic-depth)
@mixin layered-depth-effect($level: 1) {
  z-index: calc(100 + #{$level});
  transform: translateZ(calc(#{$level} * var(--layered-projection-distance, 30px)));
  filter: blur(calc((#{$level} - 1) * 1px));
}

// Audio visualization grid layout (replaces neural-pathway-network)
@mixin audio-visualization-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: var(--audio-sync-delay, 100ms);
  transition: all var(--music-sync-flow-speed, 12s) var(--dynamic-ease-motion);
}

// Card morphing states (for different card layouts)
@mixin card-morph-state($state: "default") {
  @if $state == "expanded" {
    transform: scale(1.05) translateZ(30px);
    border-radius: 20px;
  } @else if $state == "compact" {
    transform: scale(0.95) translateZ(-10px);
    border-radius: 8px;
  } @else if $state == "focused" {
    transform: scale(1.02) translateZ(40px);
    border-radius: 16px;
  } @else {
    // default state
    transform: scale(1) translateZ(0px);
    border-radius: var(--card-border-radius, 12px);
  }
}

// 3D floating animation for ambient effects
@mixin floating-3d($duration: 6s) {
  animation: floating-3d $duration ease-in-out infinite;

  @keyframes floating-3d {
    0%,
    100% {
      transform: translateZ(0px);
    }
    25% {
      transform: translateZ(10px);
    }
    50% {
      transform: translateZ(15px);
    }
    75% {
      transform: translateZ(5px);
    }
  }
}

// shadow-3d mixin removed - unused (0 references)
// Migrated functionality available in oklab-shadow-stack() presets in _design_tokens.scss

// PHASE 4: Advanced Gradient Intelligence Mixins
// =============================================================================

// Enhanced gradient ripple effect (builds on existing card-state-base)
@mixin gradient-ripple(
  $color: var(--ripple-color),
  $intensity: var(--ripple-intensity)
) {
  @include performance-optimized; // Use existing performance mixin
  @include card-transition(0.2s); // Use existing transition system

  position: relative;
  overflow: hidden;

  &::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: radial-gradient(
      circle,
      rgba(var(--spice-rgb-accent), $intensity) 0%,
      rgba(var(--spice-rgb-accent), calc($intensity * 0.5)) 30%,
      transparent 70%
    );
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
    pointer-events: none;
    z-index: 2;
    transition: all var(--ripple-duration, 0.4s) var(--sn-anim-easing-standard);
  }

  &:active::after {
    transform: translate(-50%, -50%) scale(20);
    opacity: 1;
    transition-duration: 0s;
  }
}

// Subtle gradient glow for hover states
@mixin gradient-glow(
  $color: rgba(var(--sn-dynamic-accent-rgb, var(--spice-rgb-accent)), 1),
  $intensity: 0.2
) {
  @include performance-optimized;

  position: relative;

  &::before {
    content: "";
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(
      135deg,
      rgba(var(--sn-dynamic-accent-rgb, var(--spice-rgb-accent)), $intensity) 0%,
      transparent 40%,
      transparent 60%,
      rgba(
        var(--sn-dynamic-accent-rgb, var(--spice-rgb-accent)),
        calc($intensity * 0.7)
      ) 100%
    );
    border-radius: inherit;
    z-index: -1;
    opacity: 0;
    transition: opacity var(--sn-bg-gradient-transition, 0.8s ease-in-out);
    pointer-events: none;
  }

  &:hover::before {
    opacity: 1;
  }
}

// Interactive feedback for buttons and controls
@mixin interaction-feedback($scale: 1.02, $glow: true) {
  @include card-transition(0.2s);

  &:hover {
    @include interactive-scale($scale);

    @if $glow {
      @include gradient-glow();
    }
  }

  &:active {
    transform: scale(0.98);
    transition-duration: 0.1s;
  }

  &:focus-visible {
    outline: 2px solid rgba(var(--spice-rgb-accent), 0.8);
    outline-offset: 2px;
  }
}

// Advanced performance animation (CPU/GPU optimized with fallbacks)
@mixin performance-animation(
  $property,
  $duration,
  $easing: ease-in-out,
  $delay: 0s
) {
  @include hardware-accelerated;
  transition: #{$property} #{$duration} #{$easing} #{$delay};

  // GPU optimization for complex transforms
  @if index($property, transform) {
    will-change: transform;
  }

  // Disable on reduced motion
  @media (prefers-reduced-motion: reduce) {
    transition: #{$property} calc(#{$duration} * 0.3) ease #{$delay};
  }
}

// ════════════════════════════════════════════════════════════════════════════
// 🎨 HUE-SHIFT MIXIN (Year 3000 Dynamic Palette)
// Injects a hue-rotate filter driven by a CSS variable (defaults to
// --sn-hue-shift-dynamic).  Keeps transitions smooth and respects reduced-
// motion preferences.
// ---------------------------------------------------------------------------
// Usage: @include hue-shift();                   // use default token
//        @include hue-shift(--custom-hue-var);   // custom token
// ---------------------------------------------------------------------------
@mixin hue-shift($degVar: --sn-hue-shift-dynamic) {
  // Prevent duplicate filters when parent already contains heavy effects.
  // Designers should call this mixin only on decorative layers.
  filter: hue-rotate(var(#{$degVar}));
  transition: filter 0.4s ease-out;

  // Respect user accessibility preferences.
  @media (prefers-reduced-motion: reduce) {
    filter: none !important;
  }
}

// PHASE 4.2: Context-Aware Gradient Zone System
// =============================================================================

// Context-aware gradient zone mixin (builds on existing gradient system)
@mixin context-gradient-zone($context: "default") {
  @include performance-optimized;
  position: relative;

  @if $context == "playlist" {
    --sn-bg-gradient-primary: var(--zone-playlist-primary);
    --sn-bg-gradient-secondary: var(--zone-playlist-secondary);
    --sn-current-intensity: var(--zone-intensity-playback);
  } @else if $context == "artist" {
    --sn-bg-gradient-primary: var(--zone-artist-primary);
    --sn-bg-gradient-secondary: var(--zone-artist-secondary);
    --sn-current-intensity: var(--zone-intensity-discovery);
  } @else if $context == "search" {
    --sn-bg-gradient-primary: var(--zone-search-primary);
    --sn-bg-gradient-secondary: var(--zone-search-secondary);
    --sn-current-intensity: var(--zone-intensity-focused);
  } @else if $context == "home" {
    --sn-bg-gradient-primary: var(--zone-home-primary);
    --sn-bg-gradient-secondary: var(--zone-home-secondary);
    --sn-current-intensity: var(--zone-intensity-relaxed);
  } @else if $context == "discovery" {
    --sn-bg-gradient-primary: var(--zone-artist-primary);
    --sn-bg-gradient-secondary: var(--zone-artist-secondary);
    --sn-current-intensity: var(--zone-intensity-discovery);
  } @else if $context == "playback" {
    --sn-bg-gradient-primary: var(--zone-playlist-primary);
    --sn-bg-gradient-secondary: var(--zone-playlist-secondary);
    --sn-current-intensity: var(--zone-intensity-playback);
  } @else {
    --sn-bg-gradient-primary: var(--spice-accent);
    --sn-bg-gradient-secondary: var(--spice-subtext);
    --sn-current-intensity: 1;
  }

  // Smooth context transitions (builds on existing smooth-transition)
  transition: background-color var(--zone-transition-medium) ease-in-out,
    border-color var(--zone-transition-medium) ease-in-out,
    box-shadow var(--zone-transition-medium) ease-in-out;
}

// Contextual ripple effect (extends gradient-ripple for context awareness)
@mixin context-ripple($context: "default", $intensity: 1) {
  @include context-gradient-zone($context);
  @include gradient-ripple(var(--sn-bg-gradient-primary), $intensity);

  &::after {
    background: radial-gradient(
      circle,
      rgba(var(--spice-rgb-primary), calc(0.3 * var(--sn-current-intensity))) 0%,
      rgba(var(--spice-rgb-primary), calc(0.1 * var(--sn-current-intensity)))
        30%,
      transparent 70%
    );
  }
}

// ████████████████████████████████████████████████████████████████████████████████
// PHASE 8.5: UNIFIED SHIMMER SYSTEM
// Consolidates 11 shimmer variants (118 lines) into parametric generator
// Replaces: skeleton-shimmer, holographic-shimmer, crystalline-shimmer,
//           particle-shimmer, gentle-text-shimmer, loading-pulse variants
// ████████████████████████████████████████████████████████████████████████████████

@mixin unified-shimmer(
  $type: 'skeleton',           // skeleton | gradient | filter | pulse | text
  $intensity: 'normal',        // subtle | normal | intense
  $context: 'default',         // default | playlist | artist | search | home
  $music-sync: false,          // Enable music-reactive intensity
  $grain-texture: false,       // Enable Year3000 grain overlay
  $accessibility: true         // Auto-apply reduced-motion variants
) {
  // Intensity scaling parameters
  $speed-multiplier: 1.0;
  $opacity-multiplier: 1.0;
  $filter-strength: 1.0;

  @if $intensity == 'subtle' {
    $speed-multiplier: 1.3;
    $opacity-multiplier: 0.7;
    $filter-strength: 0.6;
  } @else if $intensity == 'intense' {
    $speed-multiplier: 0.7;
    $opacity-multiplier: 1.3;
    $filter-strength: 1.5;
  }

  // Base duration (adjusted by intensity)
  $base-duration: 1.5s;
  $duration: calc(#{$base-duration} * #{$speed-multiplier});

  // Context-aware gradient colors
  $start-color: var(--sn-bg-gradient-secondary, var(--spice-surface0));
  $end-color: var(--sn-bg-gradient-accent, var(--spice-surface1));

  @if $context == 'playlist' {
    $start-color: var(--album-dominant-color, var(--sn-bg-gradient-secondary));
    $end-color: var(--album-accent-color, var(--sn-bg-gradient-accent));
  } @else if $context == 'artist' {
    $start-color: var(--artist-header-start, var(--sn-bg-gradient-primary));
    $end-color: var(--artist-header-end, var(--sn-bg-gradient-accent));
  } @else if $context == 'search' {
    $start-color: var(--spice-surface0);
    $end-color: var(--spice-surface1);
  } @else if $context == 'home' {
    $start-color: var(--sn-bg-gradient-primary, var(--spice-accent));
    $end-color: var(--spice-accent, var(--sn-bg-gradient-primary));
  }

  // Performance optimization
  @include performance-optimized;

  // Type-specific implementations
  @if $type == 'skeleton' {
    // Gradient-based position movement (replaces skeleton-shimmer)
    background: linear-gradient(
      90deg,
      #{$start-color} 0%,
      #{$end-color} 50%,
      #{$start-color} 100%
    );
    background-size: 200% 100%;
    animation: unified-skeleton-shimmer $duration ease-in-out infinite;

  } @else if $type == 'gradient' {
    // Crystalline dual-layer movement (replaces crystalline-shimmer)
    background:
      linear-gradient(90deg, #{$start-color}, transparent),
      linear-gradient(270deg, #{$end-color}, transparent);
    background-size: 200% 100%;
    opacity: calc(0.6 * #{$opacity-multiplier});
    animation: unified-gradient-shimmer calc(#{$duration} * 1.3) ease-in-out infinite;

  } @else if $type == 'filter' {
    // Holographic filter effects (replaces holographic/infinite-holographic/echo shimmers)
    animation: unified-filter-shimmer calc(#{$duration} * 2) ease-in-out infinite;

  } @else if $type == 'pulse' {
    // Opacity-based pulsing (replaces loading-pulse, particle-shimmer)
    $opacity-start: calc(0.5 * #{$opacity-multiplier});
    $opacity-peak: calc(0.8 * #{$opacity-multiplier});
    opacity: $opacity-start;
    animation: unified-pulse-shimmer $duration ease-in-out infinite;

  } @else if $type == 'text' {
    // Text-specific shimmer (replaces gentle-text-shimmer)
    --text-shimmer-intensity: calc(0.3 * #{$opacity-multiplier});
    opacity: var(--text-shimmer-intensity);
    text-shadow: 0 0 5px rgba(var(--sn-bg-gradient-accent-rgb), calc(0.2 * #{$opacity-multiplier}));
    animation: unified-text-shimmer calc(#{$duration} * 1.5) ease-in-out infinite;
  }

  // Music synchronization (optional)
  @if $music-sync {
    opacity: calc((#{$opacity-multiplier} * 0.6) + (0.3 * var(--sn-current-intensity, 0.5)));
    animation-duration: calc(#{$duration} / (1 + var(--sn-current-intensity, 0.5) * 0.5));

    @if $type == 'filter' {
      filter: hue-rotate(var(--sn-music-rhythm-phase, 0deg));
    }
  }

  // Grain texture overlay (Year3000 feature)
  @if $grain-texture {
    mask-image: var(--sn-nebula-noise-url);
    mask-size: 600% 600%;
    @if $type == 'skeleton' or $type == 'gradient' {
      animation: unified-skeleton-shimmer $duration ease-in-out infinite,
                 year3000-grain-shift calc(#{$duration} * 2) linear infinite;
    }
  }

  // Accessibility: Reduced motion
  @if $accessibility {
    @media (prefers-reduced-motion: reduce) {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      opacity: calc(0.5 * #{$opacity-multiplier}) !important;
      filter: none !important;
      transform: none !important;
    }

    // High contrast mode
    @media (prefers-contrast: high) {
      opacity: calc(#{$opacity-multiplier} * 1.3);
      filter: contrast(1.2);
    }
  }
}

// Unified shimmer animations (generated once, used by all types)
@keyframes unified-skeleton-shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

@keyframes unified-gradient-shimmer {
  0%, 100% {
    background-position: -200% center, 200% center;
    opacity: 0.6;
  }
  50% {
    background-position: 200% center, -200% center;
    opacity: 1;
  }
}

@keyframes unified-filter-shimmer {
  0%, 100% {
    filter: brightness(100%) saturate(100%) hue-rotate(0deg);
  }
  25% {
    filter: brightness(120%) saturate(110%) hue-rotate(15deg);
  }
  50% {
    filter: brightness(90%) saturate(105%) hue-rotate(30deg);
  }
  75% {
    filter: brightness(110%) saturate(115%) hue-rotate(45deg);
  }
}

@keyframes unified-pulse-shimmer {
  0%, 100% {
    opacity: var(--pulse-opacity-start, 0.5);
    transform: scale(1);
  }
  50% {
    opacity: var(--pulse-opacity-peak, 0.8);
    transform: scale(var(--pulse-scale-peak, 1.05));
  }
}

@keyframes unified-text-shimmer {
  0%, 100% {
    opacity: var(--text-shimmer-intensity, 0.3);
    text-shadow: 0 0 5px rgba(var(--sn-bg-gradient-accent-rgb), 0.2);
  }
  50% {
    opacity: calc(var(--text-shimmer-intensity, 0.3) * 1.4);
    text-shadow: 0 0 8px rgba(var(--sn-bg-gradient-accent-rgb), 0.4);
  }
}

// ████████████████████████████████████████████████████████████████████████████████
// PHASE 8.5B: ADVANCED SHIMMER SYSTEM (Year3000 Effects)
// Tier 2 shimmer system for sophisticated visual effects
// Supports: border-radius morphing, perspective breathing, complex choreography
// Use for: cosmic depth, holographic fluidity, organic morphing, advanced particles
// ████████████████████████████████████████████████████████████████████████████████

@mixin advanced-shimmer(
  $type: 'holographic',     // holographic | cosmic-depth | fluid-organic | particle-field
  $intensity: 'normal',     // subtle | normal | intense
  $music-sync: false,       // Enable music-reactive effects (--sn-music-rhythm-phase)
  $accessibility: true      // Auto-apply reduced-motion variants
) {
  // Intensity scaling parameters
  $speed-multiplier: 1.0;
  $effect-strength: 1.0;

  @if $intensity == 'subtle' {
    $speed-multiplier: 1.4;
    $effect-strength: 0.6;
  } @else if $intensity == 'intense' {
    $speed-multiplier: 0.6;
    $effect-strength: 1.5;
  }

  // Base duration (adjusted by intensity)
  $base-duration: 8s; // Longer for sophisticated effects
  $duration: calc(#{$base-duration} * #{$speed-multiplier});

  // Performance optimization
  @include performance-optimized;

  // Type-specific implementations
  @if $type == 'holographic' {
    // Border-radius morphing + music-reactive filters (fluid organic shapes)
    @if $music-sync {
      animation: advanced-holographic-shimmer-music $duration ease-in-out infinite;
    } @else {
      animation: advanced-holographic-shimmer $duration ease-in-out infinite;
    }

  } @else if $type == 'cosmic-depth' {
    // Perspective breathing + blur + hue-rotate (3D cosmic depth)
    @if $music-sync {
      animation: advanced-cosmic-depth-music $duration ease-in-out infinite;
    } @else {
      animation: advanced-cosmic-depth $duration ease-in-out infinite;
    }

  } @else if $type == 'fluid-organic' {
    // Complex multi-property morphing (advanced fluid effects)
    animation: advanced-fluid-organic $duration ease-in-out infinite;

  } @else if $type == 'particle-field' {
    // Advanced scale/opacity/rotation (particle systems)
    animation: advanced-particle-field $duration ease-in-out infinite;
  }

  // Accessibility: Reduced motion
  @if $accessibility {
    @media (prefers-reduced-motion: reduce) {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      filter: none !important;
      transform: none !important;
      border-radius: inherit !important;
      perspective: none !important;
    }

    // High contrast mode
    @media (prefers-contrast: high) {
      filter: contrast(1.3) brightness(1.1);
    }
  }
}

// Advanced shimmer animations (Year3000 sophistication)

// Holographic shimmer - border-radius morphing + filters (organic fluid shapes)
@keyframes advanced-holographic-shimmer {
  0%, 100% {
    border-radius: 50% 50% 50% 50% / 50% 50% 50% 50%;
    filter: brightness(1) saturate(1.2) hue-rotate(0deg);
  }
  25% {
    border-radius: 60% 40% 70% 30% / 40% 80% 20% 60%;
    filter: brightness(1.1) saturate(1.3) hue-rotate(30deg);
  }
  50% {
    border-radius: 30% 70% 40% 60% / 80% 20% 60% 40%;
    filter: brightness(1.2) saturate(1.4) hue-rotate(60deg);
  }
  75% {
    border-radius: 70% 30% 60% 40% / 20% 80% 40% 60%;
    filter: brightness(1.1) saturate(1.3) hue-rotate(90deg);
  }
}

// Holographic shimmer with music synchronization
@keyframes advanced-holographic-shimmer-music {
  0%, 100% {
    border-radius: 50% 50% 50% 50% / 50% 50% 50% 50%;
    filter: brightness(1) saturate(1.2) hue-rotate(var(--sn-music-rhythm-phase, 0deg));
  }
  25% {
    border-radius: 60% 40% 70% 30% / 40% 80% 20% 60%;
    filter: brightness(1.1) saturate(1.3) hue-rotate(calc(var(--sn-music-rhythm-phase, 0deg) + 30deg));
  }
  50% {
    border-radius: 30% 70% 40% 60% / 80% 20% 60% 40%;
    filter: brightness(1.2) saturate(1.4) hue-rotate(calc(var(--sn-music-rhythm-phase, 0deg) + 60deg));
  }
  75% {
    border-radius: 70% 30% 60% 40% / 20% 80% 40% 60%;
    filter: brightness(1.1) saturate(1.3) hue-rotate(calc(var(--sn-music-rhythm-phase, 0deg) + 90deg));
  }
}

// Cosmic depth - perspective breathing + blur + hue-rotate (3D depth effects)
@keyframes advanced-cosmic-depth {
  0% {
    filter: blur(0px) brightness(1) hue-rotate(0deg);
    perspective: 1000px;
  }
  25% {
    filter: blur(1px) brightness(1.2) hue-rotate(15deg);
    perspective: 1200px;
  }
  50% {
    filter: blur(0.5px) brightness(0.8) hue-rotate(30deg);
    perspective: 800px;
  }
  75% {
    filter: blur(1.5px) brightness(1.1) hue-rotate(45deg);
    perspective: 1100px;
  }
  100% {
    filter: blur(0px) brightness(1) hue-rotate(60deg);
    perspective: 1000px;
  }
}

// Cosmic depth with music synchronization (uses CSS variables)
@keyframes advanced-cosmic-depth-music {
  0% {
    filter: blur(0px) brightness(1) hue-rotate(var(--sn-music-rhythm-phase, 0deg));
    perspective: var(--cosmic-perspective, 1000px);
  }
  25% {
    filter: blur(1px) brightness(1.2) hue-rotate(calc(var(--sn-music-rhythm-phase, 0deg) + 15deg));
    perspective: calc(var(--cosmic-perspective, 1000px) * 1.2);
  }
  50% {
    filter: blur(0.5px) brightness(0.8) hue-rotate(calc(var(--sn-music-rhythm-phase, 0deg) + 30deg));
    perspective: calc(var(--cosmic-perspective, 1000px) * 0.8);
  }
  75% {
    filter: blur(1.5px) brightness(1.1) hue-rotate(calc(var(--sn-music-rhythm-phase, 0deg) + 45deg));
    perspective: calc(var(--cosmic-perspective, 1000px) * 1.1);
  }
  100% {
    filter: blur(0px) brightness(1) hue-rotate(calc(var(--sn-music-rhythm-phase, 0deg) + 60deg));
    perspective: var(--cosmic-perspective, 1000px);
  }
}

// Fluid organic - complex multi-property morphing
@keyframes advanced-fluid-organic {
  0%, 100% {
    border-radius: 45% 55% 50% 50% / 50% 45% 55% 50%;
    transform: rotate(0deg) scale(1);
    filter: brightness(1) saturate(1.1);
  }
  33% {
    border-radius: 55% 45% 60% 40% / 40% 60% 45% 55%;
    transform: rotate(120deg) scale(1.05);
    filter: brightness(1.1) saturate(1.2);
  }
  66% {
    border-radius: 40% 60% 45% 55% / 55% 40% 60% 45%;
    transform: rotate(240deg) scale(0.95);
    filter: brightness(0.9) saturate(1.15);
  }
}

// Particle field - advanced scale/opacity/rotation
@keyframes advanced-particle-field {
  0%, 100% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }
  25% {
    transform: scale(1.1) rotate(90deg);
    opacity: 0.8;
  }
  50% {
    transform: scale(0.8) rotate(180deg);
    opacity: 1;
  }
  75% {
    transform: scale(1.05) rotate(270deg);
    opacity: 0.9;
  }
}

// ████████████████████████████████████████████████████████████████████████████████
// LEGACY COMPATIBILITY: skeleton-gradient() (deprecated - use unified-shimmer)
// Preserved for backward compatibility until all references are migrated
// ████████████████████████████████████████████████████████████████████████████████
@mixin skeleton-gradient($width: 100%, $height: 20px) {
  width: $width;
  height: $height;
  border-radius: 4px;
  @include unified-shimmer($type: 'skeleton', $context: 'default');
}

// === Year 3000 Text Gradient Utility ======================================
// Supports angle & multi-stop maps while remaining backward-compatible.
// Example multi-stop usage:
//   $stops: (
//     0%: rgba(var(--sn-bg-gradient-primary-rgb),1),
//     60%: rgba(var(--sn-bg-gradient-secondary-rgb),1),
//     100%: rgba(var(--sn-bg-gradient-accent-rgb),1)
//   );
//   @include text-gradient(null, null, 90deg, $stops);

@mixin text-gradient(
  $start: var(--sn-bg-gradient-primary),
  $end: var(--sn-bg-gradient-accent),
  $angle: 135deg,
  $stops: null
) {
  // Build gradient string
  $gradient: null;

  @if $stops == null {
    $gradient: unquote("linear-gradient(#{$angle}, #{$start} 0%, #{$end} 100%)");
  } @else {
    $pairs: ();
    @each $pos, $color in $stops {
      $pairs: append($pairs, "#{$color} #{$pos}", comma);
    }
    $gradient: unquote("linear-gradient(#{$angle}, #{$pairs})");
  }

  background: $gradient;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;

  // Fallback for browsers not supporting text clipping
  @supports not (background-clip: text) {
    color: var(--spice-text);
    background: none;
    -webkit-text-fill-color: unset;
  }
}

// === Year 3000 Dynamic Text Glow ==========================================
// Creates a soft glow whose strength follows a CSS variable (0-1).
// Example: @include text-glow(--sn-bg-gradient-accent-rgb);
@mixin text-glow($rgbVar, $intensityVar: --sn-text-glow-intensity) {
  text-shadow: 0 0 calc(2px + 6px * var(#{$intensityVar}))
      rgba(var(#{$rgbVar}), calc(0.3 + 0.4 * var(#{$intensityVar}))),
    0 1px 2px #{oklab-color('shadow', 0.1)};
}

// === Magnetic Depth Utility Animations =====================

@keyframes magnetic-invitation-pulse {
  0%, 100% {
    transform: translateZ(0px) scale(1);
  }
  50% {
    transform: translateZ(4px) scale(1.01);
  }
}

// === Nebula Gradient Smoothing – Noise Overlay Mixin (Phase 1) ==============
// Provides a tiled SVG fractal noise pattern for reducing gradient banding.
// Consumers control opacity, background-size, and blend mode in their own
// rule context for maximum flexibility.
//
// $opacity is retained for future compile-time scenarios but is currently
// unused because opacity is handled via runtime CSS variables.
@mixin nebula-noise($opacity: 0.06) {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc2NCcgaGVpZ2h0PSc2NCc+PGZpbHRlciBpZD0nZic+PGZlVHVyYnVsZW5jZSB0eXBlPSdmcmFjdGFsTm9pc2UnIGJhc2VGcmVxdWVuY3k9Jy4yJyBudW1PY3RhdmVzPSc0JyBzdGl0Y2hUaWxlcz0nc3RpdGNoJy8+PC9maWx0ZXI+PHJlY3Qgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgZmlsdGVyPSd1cmwoI2YpJy8+PC9zdmc+");
  background-repeat: repeat;
}

// ═══════════════════════════════════════════════════════════════════════════════
// CDF VARIABLE ALIAS MIXIN (Phase 2)
// Provides a shorthand to alias legacy CSS variables to the new --sn-cdf-* ones.
// Usage: inside a :root block → @include cdf-alias('sn-old', 'sn-cdf-new');
// ═══════════════════════════════════════════════════════════════════════════════

@mixin cdf-alias($old, $new) {
  // Emit CSS variable reassignment so legacy selectors continue to work.
  --#{$old}: var(--#{$new});
}

// === Performance Helper – GPU-Only Wrapper ===
// Use when an optimisation or effect should run only on devices that
// advertise a fast display update frequency (usually ≥60 Hz). The
// `update` media feature is supported by all evergreen browsers.
//
// Example:
//   @include gpu-only {
//     filter: drop-shadow(0 2px 6px rgba(#000, .25));
//   }
@mixin gpu-only {
  @media (update: fast) {
    @content;
  }
}

// Forward centralised DOM selector helpers so any module that `@use`s
// `_mixins.scss` automatically gains access.

// ═══════════════════════════════════════════════════════════════════════════════
// SHADOW PATTERN CONSOLIDATION MIXINS (Phase 8.5b+)
// Consolidates 26+ repetitive shadow patterns into parametric generators
// ═══════════════════════════════════════════════════════════════════════════════

/// Music-reactive shadow mixin for sidebar elements
/// Creates box-shadows that respond to musical intensity via --sn-sidebar-harmonic-intensity-multiplier
/// @param {Number} $blur - Blur radius (default: 80px)
/// @param {Number} $spread - Spread radius, usually negative (default: -20px)
/// @param {Number} $base-opacity - Base opacity before multiplier (default: 0.15)
/// @param {Boolean} $inset - Whether shadow is inset (default: true)
/// @param {Boolean} $secondary - Add secondary shadow layer (default: false)
/// @example
///   @include music-reactive-shadow(80px, -20px, 0.15, true, true);
///   // Outputs: box-shadow: inset 0 0 80px -20px rgba(...), inset 0 0 30px 5px rgba(...);
@mixin music-reactive-shadow(
  $blur: 80px,
  $spread: -20px,
  $base-opacity: 0.15,
  $inset: true,
  $secondary: false
) {
  $shadow-type: if($inset, 'inset', '');

  @if $secondary {
    box-shadow:
      #{$shadow-type} 0 0 $blur $spread oklab-color('accent', calc(#{$base-opacity} * var(--sn-sidebar-harmonic-intensity-multiplier))),
      #{$shadow-type} 0 0 30px 5px oklab-color('accent', calc(#{$base-opacity * 0.66} * var(--sn-sidebar-harmonic-intensity-multiplier)));
  } @else {
    box-shadow: #{$shadow-type} 0 0 $blur $spread oklab-color('accent', calc(#{$base-opacity} * var(--sn-sidebar-harmonic-intensity-multiplier)));
  }
}

/// Volumetric atmospheric depth shadow for layered visual effects
/// Creates multi-layer shadow stacks for 3D depth perception
/// @param {Number} $depth-multiplier - Multiplier for atmospheric depth calculation (default: 25px)
/// @param {Number} $glow-multiplier - Multiplier for glow intensity (default: 1)
/// @param {String} $stack-type - Shadow stack configuration: 'full' | 'standard' | 'enhanced' (default: 'full')
/// @example
///   @include volumetric-shadow(25px, 1.2, 'enhanced');
///   // Outputs 3-layer shadow stack with enhanced multipliers for now-playing bar
@mixin volumetric-shadow(
  $depth-multiplier: 25px,
  $glow-multiplier: 1,
  $stack-type: 'full'
) {
  @if $stack-type == 'full' {
    // Full 3-layer stack: outer glow + inset glow + depth shadow
    box-shadow:
      0 0 calc(var(--layered-atmospheric-depth) * #{$depth-multiplier}) rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * #{$glow-multiplier})),
      inset 0 0 calc(var(--layered-atmospheric-depth) * #{$depth-multiplier * 0.48}) rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * #{$glow-multiplier} * 0.3)),
      0 calc(var(--layered-depth-offset) * 0.3) calc(var(--volumetric-shadow-blur)) rgba(var(--layered-effect-rgb), calc(var(--volumetric-depth-intensity) * #{$glow-multiplier} * 0.3));
  } @else if $stack-type == 'standard' {
    // Standard 2-layer stack: outer glow + inset glow
    box-shadow:
      0 0 calc(var(--layered-atmospheric-depth) * #{$depth-multiplier * 0.8}) rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * #{$glow-multiplier} * 0.6)),
      inset 0 0 calc(var(--layered-atmospheric-depth) * #{$depth-multiplier * 0.32}) rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * #{$glow-multiplier} * 0.2));
  } @else if $stack-type == 'enhanced' {
    // Enhanced 3-layer stack with 1.2x multipliers for prominent elements
    box-shadow:
      0 0 calc(var(--layered-atmospheric-depth) * #{$depth-multiplier * 1.2}) rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * #{$glow-multiplier} * 1.2)),
      inset 0 0 calc(var(--layered-atmospheric-depth) * #{$depth-multiplier * 0.48}) rgba(var(--layered-effect-rgb), calc(var(--layered-glow-intensity) * #{$glow-multiplier} * 0.3)),
      0 calc(var(--layered-depth-offset) * 0.4) calc(var(--volumetric-shadow-blur) * 1.2) rgba(var(--layered-effect-rgb), calc(var(--volumetric-depth-intensity) * #{$glow-multiplier} * 0.4));
  }
}

// ═══════════════════════════════════════════════════════════════════════════════
// LEGACY COMPATIBILITY SYSTEM
// ═══════════════════════════════════════════════════════════════════════════════

// Consolidated legacy class bridge system
@mixin legacy-class-bridge($old-class, $new-class) {
  .#{$old-class} {
    @extend .#{$new-class} !optional;
  }
}

// Performance-optimized extend bridge (reduces CSS output)
@mixin extend-bridge($target-class) {
  @extend #{$target-class} !optional;
}
