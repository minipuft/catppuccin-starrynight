// ████████████████████████████████████████████████████████████████████████████████
// NOW PLAYING YEAR 3000 CONSCIOUSNESS MODULE
// Kinetic Verbs: BLOOM, OSCILLATE, RIPPLE, HARMONIZE
// The heartbeat of musical consciousness lives here
// ████████████████████████████████████████████████████████████████████████████████

@use "../core/_mixins" as *;
@use "../core/_design_tokens" as *;

:root {
  @include now-playing-bar-root {
    // ══════════════════════════════════════════════════════════════════════════════
    // GLASSMORPHISM INTEGRATION - Now-Playing Glass Convergence Phase 3
    // ══════════════════════════════════════════════════════════════════════════════
    
    // Apply dynamic glassmorphism effects to the now-playing bar
    // Phase 3: Beat-Sync Glass Effects - Automatic beat-responsive blur/opacity
    @include glassmorphism-dynamic;
    
    // Phase 3: COMPLETED - Beat-boost glass variable integration
    // - Blur increases by up to 5px on heavy beats (--sn-glass-beat-boost)
    // - Smooth 400ms ease-back transitions with GPU acceleration
    // - Performance optimized with meaningful threshold checks
    // TODO: Phase 4 - Add glass layering hooks for depth effects
    
    // ══════════════════════════════════════════════════════════════════════════════
    // CONTROL BUTTONS - Year 3000 Enhanced
    // ══════════════════════════════════════════════════════════════════════════════

    // Shuffle Button - YEAR 3000 ENHANCED
    .main-shuffleButton-button {
      transition: all 0.3s var(--sn-easing-explorer, ease-out);

      &:focus:not(:focus-visible, :hover) {
        color: var(--spice-spice-surface1);
      }

      &:hover {
        color: var(--spice-text);
        // Kinetic Verb: BLOOM - Enhanced hover with rhythm (scale removed)
        transform: translateZ(0);
        filter: drop-shadow(
          0 0 calc(4px * var(--sn-music-beat-pulse-intensity, 0))
            oklab-color('accent', calc(0.4 * var(--sn-music-beat-pulse-intensity, 0)))
        );
      }

      // Active Shuffle State - Rhythmic consciousness
      &.main-shuffleButton-active {
        color: var(--spice-text);
        // Kinetic Verb: OSCILLATE - Active state breathes with music (scale removed)
        transform: translateZ(0);
        text-shadow: 0 0 calc(4px * var(--sn-music-beat-pulse-intensity, 0))
          oklab-color('accent', calc(0.6 * var(--sn-music-beat-pulse-intensity, 0)));
      }
    }

    // Play Button - THE COSMIC HEART ❤️‍🔥
    .main-playButton-PlayButton.main-playButton-primary {
      // Use unified Year 3000 dynamic accent so play button palette stays in-sync
      color: var(--sn-color-accent-hex);
      position: relative;
      transition: all 0.2s var(--sn-anim-easing-bounce-smooth);

      // Kinetic Verb: BLOOM - The most important button gets maximum love (scale removed)
      transform: translateZ(0);

      // Cosmic glow around play button (static size, no expansion)
      &::before {
        content: "";
        position: absolute;
        inset: -10px;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          oklab-color('accent', calc(0.25 * var(--sn-music-beat-pulse-intensity, 0))) 0%,
          transparent 70%
        );
        z-index: -1;
        transition: opacity 0.3s ease-out, background 0.3s ease-out;
      }

      // Enhanced hover state (brighter, no size change)
      &:hover::before {
        background: radial-gradient(
          circle,
          oklab-color('accent', calc(0.35 * var(--sn-music-beat-pulse-intensity, 0))) 0%,
          transparent 70%
        );
      }
    }

    // Primary Button - Enhanced background consciousness (Glass-compatible)
    .main-button-primary {
      // Use CSS variables compatible with glassmorphism system
      background: var(
        --glass-button-background,
        linear-gradient(
          135deg,
          oklab-color('accent', 0.9) 0%,
          oklab-color('accent', 0.7) 100%
        )
      );
      border: 1px solid
        var(
          --glass-button-border,
          oklab-color('accent', 0.3)
        );
      transition: all 0.3s var(--sn-easing-explorer, ease-out);

      // TODO: Phase 2 - Add glass-button-layer for advanced depth effects
    }

    .main-button-primary:active,
    .main-button-primary:focus,
    .main-button-primary:hover {
      // Glass-compatible hover states
      background: var(
        --glass-button-background-hover,
        linear-gradient(
          135deg,
          oklab-color('accent', 0.95) 0%,
          oklab-color('accent', 0.8) 100%
        )
      );
      // Kinetic Verb: BLOOM (scale removed)
      transform: translateZ(0);
      box-shadow: 0 0 calc(6px * var(--sn-music-beat-pulse-intensity, 0))
        oklab-color('accent', calc(0.3 * var(--sn-music-beat-pulse-intensity, 0)));
    }

    // ══════════════════════════════════════════════════════════════════════════════
    // TRANSPORT CONTROLS - Skip, Generic buttons with Year 3000 consciousness
    // ══════════════════════════════════════════════════════════════════════════════
    .Button-sm-16-buttonTertiary-iconOnly-isUsingKeyboard-useBrowserDefaultFocusStyle,
    .control-button,
    .main-view-container button:hover > div[class^="ButtonInner-sc-"],
    .main-skipForwardButton-button,
    .main-skipBackButton-button {
      color: var(--spice-subtext) !important;
      transition: all 0.3s var(--sn-easing-explorer, ease-out);

      // Kinetic Verb: OSCILLATE - All controls breathe gently (scale removed)
      transform: translateZ(0);

      &:hover {
        color: var(--spice-text) !important;
        // Kinetic Verb: RIPPLE - Enhanced hover (scale removed)
        transform: translateZ(0);
        text-shadow: 0 0 calc(3px * var(--sn-music-beat-pulse-intensity, 0))
          oklab-color('accent', calc(0.4 * var(--sn-music-beat-pulse-intensity, 0)));
      }
    }

    // ══════════════════════════════════════════════════════════════════════════════
    // HEART BUTTON - Love amplifier with enhanced beat sync 💖
    // ══════════════════════════════════════════════════════════════════════════════
    .control-button-heart[aria-checked="true"],
    .main-addButton-active,
    .main-addButton-active:focus,
    .main-addButton-active:hover {
      color: var(--spice-red);
      // Kinetic Verb: BLOOM - Love pulses with glow (scale removed)
      transform: translateZ(0);
      filter: drop-shadow(
        0 0 calc(6px * var(--sn-music-beat-pulse-intensity, 0))
          rgba(var(--spice-rgb-red, 243, 139, 168), calc(0.7 * var(--sn-music-beat-pulse-intensity, 0)))
      );
      transition: all 0.15s var(--sn-anim-easing-bounce-strong); // Heart beats fast!
    }

    // ══════════════════════════════════════════════════════════════════════════════
    // PROGRESS BAR - Year 3000 Consciousness Flow
    // ══════════════════════════════════════════════════════════════════════════════
    .x-progressBar-progressBarBg {
      position: relative;

      > div > div {
        background: linear-gradient(
          calc(90deg + (var(--sn-music-rhythm-phase, 0) * 4deg)),
          // Kinetic Verb: HARMONIZE
          oklab-color('accent', 0.9) 0%,
          oklab-color('accent', 1) 50%,
          oklab-color('accent', 0.9) 100%
        );
        // Kinetic Verb: REFRACT - Progress bar glows with energy
        box-shadow: 0 0 calc(4px * var(--sn-music-beat-pulse-intensity, 0))
          oklab-color('accent', calc(0.5 * var(--sn-music-beat-pulse-intensity, 0)));
        transition: box-shadow 0.2s ease-out;
      }

      // Add subtle background rhythm animation
      &::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          90deg,
          transparent 0%,
          oklab-color('accent', calc(0.1 * var(--sn-music-beat-pulse-intensity, 0))) 50%,
          transparent 100%
        );
        z-index: -1;
        transition: all 0.3s ease-out;
      }
    }
  }
}

// ════════════════════════════════════════════════════════════════════════════════
// GLASSMORPHISM SETTINGS INTEGRATION - Now-Playing Glass Convergence
// ════════════════════════════════════════════════════════════════════════════════

// Glass intensity controls (integrates with settings system)
.sn-glass-disabled {
  @include now-playing-bar-root {
    // Disable glass effects, use solid backgrounds
    background: rgba(var(--spice-rgb-surface0), 0.9) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;

    &::before {
      background: oklab-color('accent', 0.8) !important;
    }
  }
}

// Performance and accessibility optimizations for now-playing bar
@media (prefers-reduced-motion: reduce) {
  @include now-playing-bar-root {
    // Disable glass animations but keep basic glass effect
    transition: none !important;
    transform: none !important;
    filter: none !important;
    animation: none !important;

    &::before,
    &::after {
      animation: none !important;
      transition: none !important;
    }
  }
}

// Performance optimization for lower-end devices
@media (max-resolution: 1dppx) {
  @include now-playing-bar-root {
    // Disable complex glass effects on low-resolution displays
    &::after {
      display: none;
    }
  }
}

// Solid fallback for unsupported browsers
@supports not (backdrop-filter: blur(1px)) {
  @include now-playing-bar-root {
    background: rgba(var(--spice-rgb-surface0), 0.9) !important;
    border-top: 1px solid rgba(var(--spice-rgb-surface1), 0.5);
  }
}
